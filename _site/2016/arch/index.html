<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"> <title>Installing Arch on a Macbook Pro &#8211; UTF-9000</title> <meta name="description" content="Aww hell, it’s brok-, wait no, we’re fine"> <meta name="keywords" content="Arch, Experiments, Linux"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:image" content="http://localhost:4000//assets/img/covers/arch.png"> <meta name="twitter:title" content="Installing Arch on a Macbook Pro"> <meta name="twitter:description" content="Aww hell, it’s brok-, wait no, we’re fine"> <meta name="twitter:site" content="@sentreh"> <meta name="twitter:creator" content="@sentreh"> <!-- Open Graph --> <meta property="og:locale" content="en_NZ"> <meta property="og:type" content="article"> <meta property="og:title" content="Installing Arch on a Macbook Pro"> <meta property="og:description" content="Aww hell, it’s brok-, wait no, we’re fine"> <meta property="og:url" content="http://localhost:4000/2016/arch/"> <meta property="og:site_name" content="UTF-9000"> <meta property="og:image" content="http://localhost:4000/images/halve.png"> <link rel="canonical" href="http://localhost:4000/2016/arch/"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Feed --> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="" /> <!-- Favicons --> <link rel="shortcut icon" type="image/png" href="http://localhost:4000/favicon.png" /> <link rel="shortcut icon" href="http://localhost:4000/favicon.ico" /> <!-- CSS --> <link rel="stylesheet" type="text/css" href="http://localhost:4000/assets/css/main.css"> <!-- Left Block Image for Posts --> <style type="text/css"> #posts.inner-post-page .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(http://localhost:4000//assets/img/covers/arch.png) no-repeat;background-size: cover;} </style> <!-- Left Block Images for Home and Pages --> <style type="text/css"> .block-left {background: linear-gradient(rgba(44,45,51,0.9), rgba(44,45,51,0.9)), url(http://localhost:4000/images/home.jpg) no-repeat;background-size: cover;} </style> </head> <body id="posts" class="inner-post-page"> <div class="block-left"> <div class="content"> <a href="http://localhost:4000" class="logo"><img src="http://localhost:4000/images/halve.png"></a> <div class="post-title-section"> <div class="section-line">Posts <em>/</em></div> <h1 class="section-title">Installing Arch on a Macbook Pro </h1> <ul class="tags"> <li><a href="http://localhost:4000/tags#Arch">Arch</a></li> <li><a href="http://localhost:4000/tags#Experiments">Experiments</a></li> <li><a href="http://localhost:4000/tags#Linux">Linux</a></li> </ul> <div class="section-line reverse"><a href="http://localhost:4000">Back to posts</a> <em>/</em></div> </div> </div> </div> <div class="block-right"> <div class="inner-post content"> <div class="date-highlight">19 Dec 2016</div> <p>The basic steps towards installing Arch Linux on a Macbook Pro</p> <p>As a bit of fun, I attempted to try installing Arch Linux on my Macbook Pro.</p> <p>Originally, this didn’t work but I’ve since figured out what I was missing (and I’ve noted it below)</p> <p>This will only be enough for the base install though. You can follow the Arch wiki if you want to go through with installing Gnome but I haven’t decided on a desktop environment I like yet.</p> <p>When I do, I’ll probably do a longer post explaining the steps.</p> <p>The disk partitioning likely isn’t the most efficient use of space so be sure to look up some other guides too.</p> <h3 id="keyboard">Keyboard</h3> <p>First things first:</p> <p>By default, your <code class="highlighter-rouge">~</code> key will spit out a <code class="highlighter-rouge">&lt;</code> so we need to fix that</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh">touch /etc/rc.local
<span class="nb">echo</span> <span class="s2">"echo 0 &gt; /sys/module/hid_apple/parameters/iso_layout"</span> &gt; /etc/rc.local
<span class="nb">source</span> /etc/rc.local</code></pre></figure> <p>This part pretty much goes for any Linux OS on a Macbook.</p> <h3 id="connect-to-wifi">Connect to WiFi</h3> <p>Next up, we need to connect to WiFi. You can manually use things like the <code class="highlighter-rouge">wpa_supplicant.conf</code> file but the built in <code class="highlighter-rouge">wifi-menu</code> command is way easier.</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh">wifi-menu</code></pre></figure> <p>Once you’ve set up a profile and connected, you can check that you have an IP address assigned with <code class="highlighter-rouge">ip addr</code> and then ping google to check that you’re receiving data with <code class="highlighter-rouge">ping google.com -c 3</code></p> <h3 id="partitions">Partitions</h3> <p>This part was a huge pain in the butt for me</p> <p>First we need to get the location of your primary hard drive. You can run <code class="highlighter-rouge">fdisk -l</code> to list all of your hard drives. For me, my primary drive is <code class="highlighter-rouge">/dev/sdb</code> which may differ for you.</p> <p><strong>Note</strong>: <em>_Going forward, I’ll be using <code class="highlighter-rouge">/dev/sdb</code> but if it’s different for you, replace it with your own drive location_</em></p> <p>For myself, I have a 250GB SSD but you’ll have to decide what you’re after yourself.</p> <p>The setup I decided on was a 500MB EFI boot partition, 20GB root partition, 7.5GB swap partition and the remainder assigned to <code class="highlighter-rouge">/home</code></p> <p>First step is to run <code class="highlighter-rouge">parted /dev/sdb</code> so we can specify how we want to set up our partition</p> <p>EDIT: <strong>NOTE: File locations like [/boot] are just for reference! They are not part of the commands</strong></p> <p>Funnily enough, I was using my own guide to install Arch on an Intel NUC and fell into that trap. I’ve also changed <code class="highlighter-rouge">mklabel msdos</code> to <code class="highlighter-rouge">mklabel gpt</code> because I forgot to alter my notes.</p> <p>As far as the different between UEFI and BIOS requirements, I’m still learning but you’d use GPT with UEFI in order to be able to make an EFI partition?</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh">mklabel gpt
mkpart ESP fat32 1MiB 500MiB <span class="o">[</span>/boot]
<span class="nb">set </span>1 boot on
mkpart primary ext4 500MiB 20.5GiB <span class="o">[</span>/]
mkpart primary linux-swap 20.5GiB 28GiB <span class="o">[</span>swap]
mkpart primary ext4 28GiB 100% <span class="o">[</span>/home]
Ctrl + C</code></pre></figure> <p>Once that’s done, checking <code class="highlighter-rouge">fdisk -l</code> again should show the partition setup like so:</p> <table> <thead> <tr> <th>Device</th> <th>Size</th> <th>Type</th> </tr> </thead> <tbody> <tr> <td>/dev/sdb1</td> <td>499M</td> <td>EFI</td> </tr> <tr> <td>/dev/sdb2</td> <td>20G</td> <td>Linux</td> </tr> <tr> <td>/dev/sdb3</td> <td>7.5G</td> <td>Linux swap / Solaris</td> </tr> <tr> <td>/dev/sdb4</td> <td>205.8G</td> <td>Linux</td> </tr> </tbody> </table> <p>Now that we’ve specificied the partitions, we actually need to make some file systems for them and activate the swap partition:</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh">mkfs.vfat -F32 /dev/sdb1 <span class="o">[</span>/boot]
mkfs.ext4 /dev/sdb2 <span class="o">[</span>/]
mkswap /dev/sdb3 <span class="o">[</span>swap]
swapon /dev/sdb3
mkfs.ext4 /dev/sdb4 <span class="o">[</span>/home]</code></pre></figure> <h3 id="mounting-the-filesystems">Mounting the filesystems</h3> <p>With our filesystems created and swap partition activated, we can mount the filesystems in order to start installing our operating system</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh">mount /dev/sdb2 /mnt
mkdir -p /mnt/boot
mount /dev/sdb1 /mnt/boot
mkdir -p /mnt/home
mount /dev/sdb4 /mnt/home</code></pre></figure> <p>For anyone wondering why they’ve never seen <code class="highlighter-rouge">/mnt</code> before, it doesn’t actually exist. In the end, it just resolves to <code class="highlighter-rouge">/</code>. For example, <code class="highlighter-rouge">/mnt/home</code> just becomes <code class="highlighter-rouge">/home</code> and so on.</p> <h3 id="installing-base-packages">Installing base packages</h3> <p>With the filesystems mounted, it’s time to install the base Arch packages</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh">pacstrap /mnt base base-devel</code></pre></figure> <h3 id="fiddly-setup-bits-and-pieces">Fiddly setup bits and pieces</h3> <p>This is the last little step before we can get a <code class="highlighter-rouge">bash</code> sh running which should make terminal fans feel more comfortable.</p> <p>We’ll want to generate an fstab template to <code class="highlighter-rouge">/etc/fstab</code> for later so we can name our filesystems and then use <code class="highlighter-rouge">arch-chroot</code> to get bash working</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh">genfstab -U /mnt &gt;&gt; /mnt/etc/fstab
arch-chroot /mnt /bin/bash</code></pre></figure> <p>Next we’ll generate our locale. When you edit <code class="highlighter-rouge">/etc/locale.gen</code>, you’ll see every available locale and you just need to uncomment your respective one. For me, it’s <code class="highlighter-rouge">en_NZ.UTF-8</code>.</p> <p>For you, it’ll just be whichever matches your respective language and country code. You’ll likely want to choose the <code class="highlighter-rouge">UTF-8</code> option if there are multiple choices.</p> <p>Generate locale</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh">nano /etc/locale.gen
locale-gen
<span class="nb">echo </span><span class="nv">LANG</span><span class="o">={</span>locale<span class="o">}</span> &gt; /etc/locale.conf</code></pre></figure> <p>I hope it goes without saying that <strong>{locale} is a placeholder. Swap it with your own locale eg: <code class="highlighter-rouge">LANG=en_NZ.UTF-8</code></strong></p> <p>Next, we’ll be setting our timezones. Again, just swap NZ for your country code.</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh">ln -sf /usr/share/zoneinfo/NZ /etc/localtime
hwclock --systohc</code></pre></figure> <h3 id="fix-boot-order-and-optimise-ssd">Fix boot order and optimise SSD</h3> <p>This part can be a bit confusing. By default, in your <code class="highlighter-rouge">fstab</code> file, the boot order of your partitions may possibly be the wrong way around.</p> <p>For me, <code class="highlighter-rouge">/dev/sdb1</code> should be set to <code class="highlighter-rouge">01</code> and <code class="highlighter-rouge">/dev/sdb2</code> should be set to <code class="highlighter-rouge">02</code> but they were the wrong way around.</p> <p>You’ll want to edit fstab and make sure they’re set correctly.</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh">nano /etc/fstab</code></pre></figure> <p>For some optional optimisation (no idea what, I just saw this somewhere along the way), you can add <code class="highlighter-rouge">discard</code> to the line <code class="highlighter-rouge">rw,relatime,data=ordered</code> on the <code class="highlighter-rouge">/home</code> partition in your <code class="highlighter-rouge">fstab</code> file.</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh">rw,relatime,data<span class="o">=</span>ordered,discard</code></pre></figure> <h3 id="enable-fan-and-temp-sensor-kernel-modules">Enable fan and temp sensor kernel modules</h3> <p>Apparently the fan and temperature sensor kernel modules aren’t enabled by default.</p> <p>Easily fixed by adding <code class="highlighter-rouge">coretemp</code> and <code class="highlighter-rouge">applesmc</code> to <code class="highlighter-rouge">/etc/modules</code></p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh">nano /etc/modules</code></pre></figure> <h3 id="create-a-hostname-for-your-computer">Create a hostname for your computer</h3> <p>The hostname is what your computer will be referred to as. If you’ve seen <code class="highlighter-rouge">username@computername</code> in terminals before, the computername section is what this hostname will be.</p> <p>All you need to do is edit it and add your desired hostname. Just the name and nothing else.</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh">nano /etc/hostname</code></pre></figure> <p>You’ll also want to add the <code class="highlighter-rouge">hostname</code> after both <code class="highlighter-rouge">localhost</code> instances in your hosts file</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh">nano /etc/hosts</code></pre></figure> <h3 id="make-initial-kernel--environment-to-open-partitions">Make initial kernel / environment to open partitions</h3> <p>Admittedly, this is where I get a bit lost but I believe we’re generating the Linux kernel for our OS? I don’t even know what I’m talking about but it’s the next step</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh">mkinitcpio -p linux</code></pre></figure> <h3 id="set-root-password">Set root password</h3> <p>Well, simply put, it’s the password used for the root account. You know, for using with <code class="highlighter-rouge">sudo</code> and what not.</p> <p>It’s as simple as running one command and entering in the password you’d like</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh">passwd</code></pre></figure> <h3 id="preserve-lan-support-for-later">Preserve LAN support for later</h3> <p>I don’t recall the exact reason for this but I suppose it’s assumed after the upcoming restart that LAN support will be lost. I never had this issue but there’s no hard in it anyway.</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh">pacman -S dhcpcd
systemctl <span class="nb">enable </span>dhcpcd</code></pre></figure> <h3 id="install-bootloader-for-macbook-pro">Install bootloader for Macbook Pro</h3> <p>Here is where things went sideways for me. As far as I’m aware, these are the correct commands for installing the UEFI bootloader (I never tried using grub2 which may fix this issue)</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh">pacman -S dosfstools
bootctl --path<span class="o">=</span>/boot install</code></pre></figure> <h3 id="create-a-boot-entry">Create a boot entry</h3> <p>We need to make a new entry in the boot segment</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh">nano /boot/loader/entries/arch.conf</code></pre></figure> <p>and then configure it by entering the following</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh">title Arch Linux
linux /vmlinuz-linux
initrd /initramfs-linux.img
options <span class="nv">root</span><span class="o">=</span>/dev/sda2 rw <span class="nv">elevator</span><span class="o">=</span>deadline quiet splash <span class="nv">resume</span><span class="o">=</span>/dev/sda3 <span class="nv">nmi_watchdog</span><span class="o">=</span>0</code></pre></figure> <p><strong>NOTE</strong>: Yes, I reference <code class="highlighter-rouge">sda</code> and not <code class="highlighter-rouge">sdb</code> here. For whatever reason, the drive swaps to being <code class="highlighter-rouge">/dev/sda</code> once the install is completed and you reboot. This is what originally gave me trouble. I was referencing <code class="highlighter-rouge">/dev/sdb</code> which didn’t exist anymore.</p> <p>Once that’s all done, we then set Arch Linux as our default OS for loading like so</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nb">echo</span> <span class="s2">"default arch"</span> &gt; /boot/loader/loader.conf</code></pre></figure> <p>and reboot in order to carry on with the rest of the setup (Desktop environment and what not)</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nb">exit
</span>reboot</code></pre></figure> <p>At this point, rebooting should give you the basics of an operating system but it won’t be enough to use on a daily basis.</p> <p>The <a href="https://help.ubuntu.com/community/MacBookPro">Ubuntu</a> and <a href="https://wiki.archlinux.org/index.php/MacBook">Arch</a> wikis are good resources on where to go next as well as Google of course.</p> <br> <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/2016/arch/" class="btn btn_twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/2016/arch/" class="btn btn_facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://plus.google.com/share?url=http://localhost:4000/2016/arch/" class="btn btn_google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a> <nav class="pagination"> <a href="http://localhost:4000/2016/china/" class="pagination_pager" title="Dear China ">previous</a> <a href="http://localhost:4000/2017/ambulance/" class="pagination_pager" title="Ambulance WiFi Hotspots ">next</a> </nav> </div> </div> <!-- JS --> <script src="http://localhost:4000/assets/js/main.min.js"></script> <!-- Asynchronous Google Analytics snippet --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-25776766-13', 'auto'); ga('require', 'linkid', 'linkid.js'); ga('send', 'pageview'); </script> <div class="overlay"> <ul class="projects-menu"> <li style="background:url(http://taylantatli.me/Halve/images/halve-home-image.png) center center no-repeat;"> <a href="http://taylantatli.me/Halve" class="inactive" target="_blank" rel="nofollow external"> <span> Halve Jekyll Theme <br><em>in progress</em> </span> </a> </li> <li style="background:url(https://cloud.githubusercontent.com/assets/754514/14509720/61c61058-01d6-11e6-93ab-0918515ecd56.png) center center no-repeat;"> <a href="http://taylantatli.me/Moon" target="_blank" rel="nofollow external"> <span> Moon Jekyll Theme </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/Ramme/master/assets/img/screenshot-post.png) center center no-repeat;"> <a href="http://taylantatli.me/Ramme" target="_blank" rel="nofollow external"> <span> Ramme Jekyll Theme </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/Daisy-Pelican-Theme/master/Preview-1.png) center center no-repeat;"> <a href="http://taylantatli.me/Daisy-Pelican-Theme/" target="_blank" rel="nofollow external"> <span> Daisy Pelican Theme </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/Block-Icon-Theme/master/Preview.png) center center no-repeat;"> <a href="https://github.com/TaylanTatli/Block-Icon-Theme" class="inactive" target="_blank" rel="nofollow external"> <span> Block Icon Theme <br><em>in progress</em> </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/StartPage/master/preview.png) center center no-repeat;"> <a href="http://taylantatli.me/StartPage/" class="inactive" target="_blank" rel="nofollow external"> <span> Start Page <br><em>in progress</em> </span> </a> </li> </ul> </div> </body> </html>
