<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom"><generator uri="http://jekyllrb.com" version="3.1.2">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2017-06-08T11:10:59+12:00</updated><id>http://localhost:4000/</id><title>UTF-9000</title><subtitle>Without you to read it, this blog is just a bunch of markdown files.</subtitle><entry><title>Discord is down?</title><link href="http://localhost:4000/2017/discord/" rel="alternate" type="text/html" title="Discord is down?" /><published>2017-06-08T00:00:00+12:00</published><updated>2017-06-08T00:00:00+12:00</updated><id>http://localhost:4000/2017/discord</id><content type="html" xml:base="http://localhost:4000/2017/discord/">&lt;p&gt;I received a message from someone at about 3am on June 8th and I mistakenly thought I received it through Discord. In hindsight, that didn‚Äôt make sense since I didn‚Äôt actually have Discord running.&lt;/p&gt;

&lt;p&gt;Anyway, I started it up and the iconic spinny logo (which I now know is actually just a webm video) appeared‚Ä¶&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/discord/startup.png&quot;&gt;&lt;img src=&quot;/assets/img/discord/startup.png&quot; alt=&quot;The Discord startup window&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;and kept spinning‚Ä¶ and spinning‚Ä¶ and ok, obviously something is up here so it‚Äôs time to do some investigating üïµÔ∏è&lt;/p&gt;

&lt;p&gt;The first step which you should always do is check out the website to see if they have a status page&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/discord/site.png&quot;&gt;&lt;img src=&quot;/assets/img/discord/site.png&quot; alt=&quot;The Discord website erroring out&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The same error appeared for &lt;a href=&quot;https://status.discordapp.com&quot;&gt;https://status.discordapp.com&lt;/a&gt; which defeats the entire purpose of having a status page. Well, perhaps we can confirm what exactly is giving the Discord app trouble by checking out &lt;code class=&quot;highlighter-rouge&quot;&gt;Console.app&lt;/code&gt;. Oh and shoutout to &lt;a href=&quot;https://twitter.com/samjarman&quot;&gt;@samjarman&lt;/a&gt; for reminding me the day before that it was a thing.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/discord/console.png&quot;&gt;&lt;img src=&quot;/assets/img/discord/console.png&quot; alt=&quot;The macOS console app showing Discord errors&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Well, it‚Äôs not too surprising considering I couldn‚Äôt access the main site but as we can see, there‚Äôs an &lt;code class=&quot;highlighter-rouge&quot;&gt;HTTP Load Failed&lt;/code&gt; error!&lt;/p&gt;

&lt;p&gt;Hmm, at this point, I decided to check if it was just me having this issue. There was no mention of any issues by &lt;a href=&quot;https://twitter.com/discordapp&quot;&gt;@discordapp&lt;/a&gt; but that doesn‚Äôt mean there‚Äôs nothing at all. In times like this, &lt;a href=&quot;https://search.twitter.com&quot;&gt;search.twitter.com&lt;/a&gt; becomes your best friend.&lt;/p&gt;

&lt;p&gt;Sorting by latest, I came across at least a few users:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/discord/tweet1.png&quot;&gt;&lt;img src=&quot;/assets/img/discord/tweet1.png&quot; alt=&quot;Twitter User @BJ007PRO saying Discord is down&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/discord/tweet2.png&quot;&gt;&lt;img src=&quot;/assets/img/discord/tweet2.png&quot; alt=&quot;Twitter User @Prens1327 saying Discord is down&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/discord/tweet3.png&quot;&gt;&lt;img src=&quot;/assets/img/discord/tweet3.png&quot; alt=&quot;Twitter User @immortalmewtwo saying Discord is down&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Well, it‚Äôs not just me then! Now that we know it‚Äôs not just a local issue, we can start to look further afield. Using a service like &lt;a href=&quot;https://isup.me&quot;&gt;isup.me&lt;/a&gt; tells us that Discord isn‚Äôt down for everyone but obviously it‚Äôs down for others in New Zealand so the issue must lay somewhere in between.&lt;/p&gt;

&lt;p&gt;Well, that means we‚Äôve got a solid case to bust out &lt;code class=&quot;highlighter-rouge&quot;&gt;traceroute&lt;/code&gt; which will list all the servers that our connection routes through when attempting to reach Discord.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/discord/traceroute.png&quot;&gt;&lt;img src=&quot;/assets/img/discord/traceroute.png&quot; alt=&quot;The output of traceroute&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The annoying part with this traceroute is that it completes. That‚Äôs great of course but it‚Äôd be a bit more obvious if it just failed at a specific server. To get around this, I tried the very scientific method of visiting each IP address starting from bottom to top.&lt;/p&gt;

&lt;p&gt;The last 2 timed out while all the previous entries returned nothing. That‚Äôs not bad of course, it just means that those servers aren‚Äôt serving anything on Port &lt;code class=&quot;highlighter-rouge&quot;&gt;80&lt;/code&gt; so chances are we can ignore them. Since the last two are attempting to respond with HTML but failing, we can assume that‚Äôs where the error lays.&lt;/p&gt;

&lt;p&gt;The highlighted entry from the screenshot above is the earliest server that times out so it makes sense to assume that‚Äôs where the problem begins or else it would just route our request on to the next server. Let‚Äôs see what we can find out about &lt;code class=&quot;highlighter-rouge&quot;&gt;198.41.236.253&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/discord/nslookup.png&quot;&gt;&lt;img src=&quot;/assets/img/discord/nslookup.png&quot; alt=&quot;Running nslookup on the IP address&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Ahh, a Cloudflare server? That makes sense. For whose who haven‚Äôt heard of it, Cloudflare provides a few services such as DDoS protection to mitigate attacks and a Content Delivery Network (CDN) for distributing services around the world.&lt;/p&gt;

&lt;p&gt;In the case of Discord, Cloudflare would be mirroring their content so we can connect to a local server rather than waiting for our connection to route all the way to the US which wouldn‚Äôt be as fast.&lt;/p&gt;

&lt;p&gt;Now that we know that, it‚Äôs worth having a look where exactly this Cloudflare is and surprise, surprise, it‚Äôs located in Auckland!&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/discord/location.png&quot;&gt;&lt;img src=&quot;/assets/img/discord/location.png&quot; alt=&quot;An IP lookup showing the Cloudflare server in Auckland&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Now it makes sense why Discord isn‚Äôt mentioning this issue because it‚Äôs not actually a Discord issue, it‚Äôs a Cloudflare issue! So, how about we check the Cloudflare status page instead?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/discord/cloudflare.png&quot;&gt;&lt;img src=&quot;/assets/img/discord/cloudflare.png&quot; alt=&quot;Cloudflare&#39;s status page&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Would ya look at that, it‚Äôs &lt;code class=&quot;highlighter-rouge&quot;&gt;Re-routed&lt;/code&gt;. That‚Äôs not explicitly an error but we‚Äôve got users in New Zealand having issues on the left and a New Zealand server with a status other than &lt;code class=&quot;highlighter-rouge&quot;&gt;Operational&lt;/code&gt; on the right so I think it‚Äôs safe to conclude that the issue resides with Cloudflare (the middlemen and middlewomen, geddit?).&lt;/p&gt;

&lt;p&gt;After a while, Cloudflare changed back to &lt;code class=&quot;highlighter-rouge&quot;&gt;Operational&lt;/code&gt; and the entire route changed aside from the first two (my router and ISP respectively) and the final address.&lt;/p&gt;

&lt;p&gt;Initially the traffic was passing from my house up to Auckland and then to San Francisco but now it passes through a bunch of &lt;a href=&quot;https://en.wikipedia.org/wiki/Bogon_filtering&quot;&gt;bogon&lt;/a&gt; addresses and one address owned by &lt;a href=&quot;https://www.ix.asn.au/&quot;&gt;IX Australia&lt;/a&gt; before popping up at the same Cloudflare address in San Francisco.&lt;/p&gt;

&lt;p&gt;Ah well, things are back in order so I can go back to chatting on Discord. I never received any acknowledgement from their Twitter account but I sent an email to their engineering department to follow up.&lt;/p&gt;

&lt;p&gt;At least, their mail server told me that engineering was a valid email address. As for how I found that out, well, that‚Äôs a blog post for another day (or you can just search &lt;code class=&quot;highlighter-rouge&quot;&gt;telnet smtp&lt;/code&gt;).&lt;/p&gt;

&lt;p&gt;If I get a reply back, I‚Äôll post an update with their response.&lt;/p&gt;</content><category term="Linux" /><category term="Networking" /><summary>Well, it was. You missed it!</summary></entry><entry><title>Testing Async functions in Mocha</title><link href="http://localhost:4000/2017/async/" rel="alternate" type="text/html" title="Testing Async functions in Mocha" /><published>2017-06-04T00:00:00+12:00</published><updated>2017-06-04T00:00:00+12:00</updated><id>http://localhost:4000/2017/async</id><content type="html" xml:base="http://localhost:4000/2017/async/">&lt;p&gt;Do you know what day it is? One month until Independence Day? Nope, it‚Äôs nothing actually, I just wanted to check that you weren‚Äôt forgetting anything.&lt;/p&gt;

&lt;p&gt;In other news, I finally tried to write some tests for &lt;a href=&quot;https://github.com/marcus-crane/pkgparse&quot;&gt;pkgparse&lt;/a&gt;, the module that I use to test out new Node features or styles of writing things.&lt;/p&gt;

&lt;p&gt;I changed it to use async/await instead of promises to celebrate the release of Node &lt;a href=&quot;https://nodejs.org/en/blog/release/v8.0.0/&quot;&gt;v8.0.0&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Now, you might say that async/await has been in Node since 7.7.4 which, yes that‚Äôs true but 8.X.X is the next Long Term Support version!&lt;/p&gt;

&lt;p&gt;The team haven‚Äôt said explicitly that it‚Äôs 8.0.0 itself but I imagine we‚Äôll start to see it looked at more until, and especially after the LTS version is announced&lt;/p&gt;

&lt;p&gt;I haven‚Äôt put in 1000 hours of testing time yet so writing tests is still something I‚Äôm learning a lot about but testing async functions is definitely a new one for me. That is to say, I‚Äôve tested promises but in order to await the function you‚Äôre testing, the actual test function needs to use await.&lt;/p&gt;

&lt;p&gt;Well, just use &lt;code class=&quot;highlighter-rouge&quot;&gt;done()&lt;/code&gt; I hear you say but the trouble I had was that using &lt;code class=&quot;highlighter-rouge&quot;&gt;expect()&lt;/code&gt; followed by &lt;code class=&quot;highlighter-rouge&quot;&gt;done()&lt;/code&gt; is mixing promises and callbacks which is a no, no according to mocha. There were a few comments around suggesting that so I don‚Äôt know what the problem was.&lt;/p&gt;

&lt;p&gt;Here‚Äôs what I‚Äôve since learnt anyway. We‚Äôll use the following function as a test example:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nx&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;exports&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;fetchDependenciesFromNPM&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;moduleName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kr&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;JSONObjectFromNPM&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;axios&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;https://registry.npmjs.org/&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;moduleName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// some filtering here blah blah&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;dependenciesExist&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;dependencies&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// eg; [&#39;mocha&#39;, &#39;express&#39;, &#39;axios&#39;]&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;statusText&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;  
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Most of this we can ignore for this example. The only things we need to know is that this function takes the name of a module as a string eg: &lt;code class=&quot;highlighter-rouge&quot;&gt;express&lt;/code&gt; and returns its NPM dependencies as an array.&lt;/p&gt;

&lt;p&gt;If there‚Äôs not dependencies at all, it just sends back an empty array instead. In reality, pkgparse uses a Set but I‚Äôm still figuring out how to deal with the contents of a Set that has no keys. Testing its size/length is easy enough.&lt;/p&gt;

&lt;p&gt;Anyway, I‚Äôm getting sidetracked here. Here‚Äôs how I‚Äôm currently testing the above function:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nx&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;should return the dependencies of a given NPM module&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;kr&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;dependencies&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;fetchDependenciesFromNPM&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;yourfavemodule&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;dependencies&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;deep&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;equal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;eslint&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;react&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&#39;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;I was fiddling with &lt;code class=&quot;highlighter-rouge&quot;&gt;try/catch&lt;/code&gt; blocks at first and &lt;code class=&quot;highlighter-rouge&quot;&gt;done()&lt;/code&gt; but apparently we can just use the regular &lt;code class=&quot;highlighter-rouge&quot;&gt;expect()&lt;/code&gt; callback which makes sense seeing as you can almost treat &lt;code class=&quot;highlighter-rouge&quot;&gt;await&lt;/code&gt;-ed functions like a regular synchronous functions.&lt;/p&gt;

&lt;p&gt;This raises the question about how to test thrown errors however. I fiddled around a bit and using the above gives you no real way to do that. One possible solution doesn‚Äôt require too much extra code though:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nx&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;should throw an error when given an invalid module name&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;fetchDependenciesFromNPM&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;blahblah&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;equal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;404 Not Found&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;I‚Äôm not exactly sure if it‚Äôs best practice but it works‚Ñ¢. I‚Äôll let you know if I have a realisation in the future that it‚Äôs all wrong!&lt;/p&gt;</content><category term="Javascript" /><category term="Node" /><category term="Testing" /><summary>Learn You An Async For Great Good</summary></entry><entry><title>Pointers</title><link href="http://localhost:4000/2017/pointers/" rel="alternate" type="text/html" title="Pointers" /><published>2017-04-18T00:00:00+12:00</published><updated>2017-04-18T00:00:00+12:00</updated><id>http://localhost:4000/2017/pointers</id><content type="html" xml:base="http://localhost:4000/2017/pointers/">&lt;p&gt;I wrote this for myself to better understand pointers but perhaps someone else may find it just as useful. I found that most mentions just kinda glossed over them because they‚Äôre ‚Äúeasy‚Äù.&lt;/p&gt;

&lt;p&gt;It‚Äôs true that they‚Äôre not hard but they didn‚Äôt really click until I wrote out in depth what‚Äôs going on.&lt;/p&gt;

&lt;p&gt;This example uses Go but you should be able to translate it into your language of choice. &lt;code class=&quot;highlighter-rouge&quot;&gt;func&lt;/code&gt; is just a function and &lt;code class=&quot;highlighter-rouge&quot;&gt;fmt.Println&lt;/code&gt; is, y‚Äôknow, &lt;code class=&quot;highlighter-rouge&quot;&gt;console.log()&lt;/code&gt; in Javascript or &lt;code class=&quot;highlighter-rouge&quot;&gt;print()&lt;/code&gt; in Python. That‚Äôs all there is specific to go.&lt;/p&gt;

&lt;p&gt;The rest onwards is unedited:&lt;/p&gt;

&lt;p&gt;In their simplest form, a pointer references a value within a computer program via its memory address. That is to say, it doesn‚Äôt copy the original value but actually alters the original value directly.
‚Äã&lt;/p&gt;

&lt;p&gt;It should be noted that they exist in a bunch of languages but for this exercise, let‚Äôs start with a small program written in Go.
‚Äã
&lt;code class=&quot;highlighter-rouge&quot;&gt;go
package main
‚Äã
import &quot;fmt&quot;
‚Äã
func setToZero(copyOfValue int) {
  copyOfValue = 0
}
‚Äã
func main() {
  value := 1
  setToZero(value)
  fmt.Println(&quot;value:&quot;, value)
}
‚Äã
// value: 1
&lt;/code&gt;
‚Äã
So, you might be thinking we‚Äôve set value to 1, we pass it into a function which sets it to 0 and then we get the result of 0 but it‚Äôs not quite that simple.
‚Äã&lt;/p&gt;

&lt;p&gt;When the setToZero function is evaluated, it doesn‚Äôt receive the actual original value variable but rather, a &lt;strong&gt;copy&lt;/strong&gt; of it. This copy is set to &lt;code class=&quot;highlighter-rouge&quot;&gt;0&lt;/code&gt; and then thrown away.
‚Äã&lt;/p&gt;

&lt;p&gt;This is where pointers come into play. Instead of passing in the value, which gets copied, we pass in a reference to where the original value variable is stored in memory.&lt;/p&gt;

&lt;p&gt;This is called &lt;strong&gt;referencing&lt;/strong&gt;. That is, we‚Äôre quite literally passing in a &lt;strong&gt;reference&lt;/strong&gt; to the memory address that &lt;code class=&quot;highlighter-rouge&quot;&gt;value&lt;/code&gt; is stored at. The reference &lt;code class=&quot;highlighter-rouge&quot;&gt;points&lt;/code&gt; to where the value is stored, hence the name.
‚Äã
&lt;code class=&quot;highlighter-rouge&quot;&gt;go
package main
‚Äã
import &quot;fmt&quot;
‚Äã
func setToZero(pointerToValue *int) {
  *pointerToValue = 0
}
‚Äã
func main() {
  value := 1
  setToZero(&amp;amp;value)
  fmt.Println(&quot;value:&quot;, value)
}
‚Äã
// value: 0
&lt;/code&gt;
‚Äã
There‚Äôs two main bits to pointers. The reference, which we can see as &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;amp;value&lt;/code&gt; points to the memory address of the original &lt;code class=&quot;highlighter-rouge&quot;&gt;value&lt;/code&gt; as stated before. The received pointer, within the &lt;code class=&quot;highlighter-rouge&quot;&gt;setToZero&lt;/code&gt; function is prefixed with a &lt;code class=&quot;highlighter-rouge&quot;&gt;*&lt;/code&gt; to denote a pointer.&lt;/p&gt;

&lt;p&gt;All we need to do is change the expected type, &lt;code class=&quot;highlighter-rouge&quot;&gt;int&lt;/code&gt; in this case to expect an &lt;code class=&quot;highlighter-rouge&quot;&gt;*int&lt;/code&gt; pointer. We can then freely alter the value at the pointers memory address by prefixing our new variable name with an &lt;code class=&quot;highlighter-rouge&quot;&gt;*&lt;/code&gt;.
‚Äã&lt;/p&gt;

&lt;p&gt;To better understand what‚Äôs happening behind the scenes, we can print out the values of &lt;code class=&quot;highlighter-rouge&quot;&gt;pointerToValue&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;*pointerToValue&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;amp;value&lt;/code&gt;.
‚Äã
&lt;code class=&quot;highlighter-rouge&quot;&gt;go
package main
‚Äã
import &quot;fmt&quot;
‚Äã
func setToZero(pointerToValue *int) {
  fmt.Println(&quot;ptrToValueDereferenced:&quot;, *pointerToValue)
  fmt.Println(&quot;ptrToValueInside:&quot;, pointerToValue)
}
‚Äã
func main() {
  value := 1
  setToZero(&amp;amp;value)
  fmt.Println(&quot;ptrToValueOutside:&quot;, &amp;amp;value)
  fmt.Println(&quot;actualValue:&quot;, value)
}
‚Äã
// ptrToValueDereferenced: 1
// ptrToValueInside: 0x1040a124
// ptrToValueOutside: 0x1040a124
// actualValue: 1
&lt;/code&gt;
‚Äã
Let‚Äôs break it down in really tiny steps:
‚Äã&lt;/p&gt;

&lt;p&gt;We pass &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;amp;value&lt;/code&gt;, a pointer to the memory address of the value variable into our &lt;code class=&quot;highlighter-rouge&quot;&gt;setToZero&lt;/code&gt; function. The value of &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;amp;value&lt;/code&gt;, our pointer, is simply the memory address &lt;code class=&quot;highlighter-rouge&quot;&gt;0x1040a124&lt;/code&gt;.
‚Äã&lt;/p&gt;

&lt;p&gt;On the inside of the function, &lt;code class=&quot;highlighter-rouge&quot;&gt;pointerToValue&lt;/code&gt; is now exactly the same as our initial &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;amp;value&lt;/code&gt; pointer. It too, is just the location of the &lt;code class=&quot;highlighter-rouge&quot;&gt;value&lt;/code&gt; variable in memory.
‚Äã&lt;/p&gt;

&lt;p&gt;Next, we &lt;strong&gt;dereference&lt;/strong&gt; our pointer using an asterisk. Our &lt;strong&gt;dereferenced&lt;/strong&gt; pointer is now the actual value, rather than the location of the value. Notice that it‚Äôs value is now &lt;code class=&quot;highlighter-rouge&quot;&gt;1&lt;/code&gt;?
‚Äã&lt;/p&gt;

&lt;p&gt;If we were to update the value, eg; &lt;code class=&quot;highlighter-rouge&quot;&gt;*pointerToValue = 2&lt;/code&gt;, then the value at that address gets updated.
‚Äã&lt;/p&gt;

&lt;p&gt;Now, that wasn‚Äôt so hard, was it! If it still doesn‚Äôt make sense, try using these examples in the &lt;a href=&quot;https://play.golang.org/&quot;&gt;Go Playground&lt;/a&gt; or using pointers in whichever language you‚Äôre ultimately using.&lt;/p&gt;

&lt;p&gt;If I got something wrong, seeing as I have exactly 15 minutes experience with pointers (there abouts) as of writing, feel free to complain via &lt;a href=&quot;&amp;#109;&amp;#097;&amp;#105;&amp;#108;&amp;#116;&amp;#111;:&amp;#109;&amp;#097;&amp;#114;&amp;#099;&amp;#117;&amp;#115;&amp;#064;&amp;#116;&amp;#104;&amp;#105;&amp;#110;&amp;#103;&amp;#115;&amp;#105;&amp;#109;&amp;#097;&amp;#046;&amp;#100;&amp;#101;&quot;&gt;email&lt;/a&gt; or &lt;a href=&quot;https://twitter.com/sentreh&quot;&gt;Twitter&lt;/a&gt;.&lt;/p&gt;</content><category term="Go" /><summary>Here&#39;s some pointers about pointers!</summary></entry><entry><title>Speeding up Deepin Linux</title><link href="http://localhost:4000/2017/deepin/" rel="alternate" type="text/html" title="Speeding up Deepin Linux" /><published>2017-02-05T00:00:00+13:00</published><updated>2017-02-05T00:00:00+13:00</updated><id>http://localhost:4000/2017/deepin</id><content type="html" xml:base="http://localhost:4000/2017/deepin/">&lt;p&gt;A few weeks back, I tried out &lt;a href=&quot;https://www.deepin.org/en/&quot;&gt;Deepin Linux&lt;/a&gt; and it‚Äôs actually quite nice! It definitely has one of the nicest desktop environments that I‚Äôve seen from a Linux distro and yes, perhaps even more so than &lt;a href=&quot;https://elementary.io/&quot;&gt;elementary OS&lt;/a&gt; in my opinion.&lt;/p&gt;

&lt;p&gt;Now that said, it also has a few major issues but nothing that can‚Äôt be fixed.&lt;/p&gt;

&lt;h3 id=&quot;package-mirrors-are-broken&quot;&gt;Package mirrors are broken&lt;/h3&gt;

&lt;p&gt;By default, Deepin ships with the official CDN mirror enabled and holy heck is it slow. I‚Äôm talking outright unusable but that‚Äôs not so bad because there‚Äôs a mirror selector‚Ä¶&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/deepin/packageselector.jpg&quot;&gt;&lt;img src=&quot;/assets/img/deepin/packageselector.jpg&quot; alt=&quot;A screenshot of the built in package mirror selector&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;that does absolutely nothing. Click any mirror you like but nothing will actually change.&lt;/p&gt;

&lt;p&gt;It‚Äôs not like it would matter anyway because there‚Äôs not a single mirror that my network considers ‚ÄúFast‚Äù.&lt;/p&gt;

&lt;p&gt;The Australian mirror, which Deepin blogged about adding to the list would be faster if they had actually added it to the official list or even the OS.&lt;/p&gt;

&lt;p&gt;Let‚Äôs fix that! I‚Äôll assume you know at least how to use a terminal and &lt;code class=&quot;highlighter-rouge&quot;&gt;nano&lt;/code&gt; if you‚Äôre reading this.&lt;/p&gt;

&lt;p&gt;You‚Äôll want to head to &lt;code class=&quot;highlighter-rouge&quot;&gt;/apt/&lt;/code&gt; and open up &lt;code class=&quot;highlighter-rouge&quot;&gt;sources.list&lt;/code&gt; with &lt;code class=&quot;highlighter-rouge&quot;&gt;nano sources.list&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;You should see a file that looks like so:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;deb &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;by-hash&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;force] http://packages.deepin/deepin unstable main contrib non-free
deb-src http://packages.deepin.com/deepin unstable main contrib non-free&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Depending on where you live, you‚Äôll want to visit the mirror list &lt;a href=&quot;https://www.deepin.org/en/mirrors/packages/&quot;&gt;here&lt;/a&gt; and choose whichever is closest to you.&lt;/p&gt;

&lt;p&gt;The Australian Colocity Mirror can be found &lt;a href=&quot;http://mirror.colocity.com/deepin/&quot;&gt;here&lt;/a&gt; and still isn‚Äôt listed on the site which is a pain.&lt;/p&gt;

&lt;p&gt;Simply comment out the two entries &lt;code class=&quot;highlighter-rouge&quot;&gt;sources.list&lt;/code&gt; and create a new line that swaps out the URL for the nearby mirror.&lt;/p&gt;

&lt;p&gt;Mine looks like so with the Japanese mirror included (but commented out) just in case I might ever need a package that hasn‚Äôt been updated for example.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;c&quot;&gt;# A nice and fast Australian mirror&lt;/span&gt;
deb http://mirror.colocity.com/deepin unstable main contrib non-free

&lt;span class=&quot;c&quot;&gt;# Tsukuba WIDE Public Mirror Service&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# deb http://ftp.tsukuba.wide.ad.jp/Linux/deepin unstable main contrib non-free&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# Slow as heck official mirror (don&#39;t even bother...)&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# deb [by-hash=force] http://packages.deepin/deepin unstable main contrib non-free&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# deb-src http://packages.deepin.com/deepin unstable main contrib non-free&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;I feel like there was some other issue I had but I can‚Äôt remember since I don‚Äôt actually have Deepin installed anymore. I didn‚Äôt get bored of it, I just needed macOS again (and graphics drivers + battery life) for some stuff.&lt;/p&gt;

&lt;p&gt;Oh and while it may be tempting since Deepin is based on Debian, DO NOT use the Debian mirrors because, as I found out, they‚Äôll detect unknown packages like your desktop environment, file manager etc and rip them all out leaving you screwed!&lt;/p&gt;</content><category term="Linux" /><summary>Mirror, mirror, in /etc/apt</summary></entry><entry><title>An important note about /etc/rc.local</title><link href="http://localhost:4000/2017/rc.local/" rel="alternate" type="text/html" title="An important note about /etc/rc.local" /><published>2017-01-24T00:00:00+13:00</published><updated>2017-01-24T00:00:00+13:00</updated><id>http://localhost:4000/2017/rc.local</id><content type="html" xml:base="http://localhost:4000/2017/rc.local/">&lt;p&gt;I got caught out by this for quite a while&lt;/p&gt;

&lt;p&gt;For those of you who may not have encountered &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/rc.local&lt;/code&gt; before while using a Linux distro, it‚Äôs a file that will run commands placed into it on startup.&lt;/p&gt;

&lt;p&gt;Personally, the only two things I use it for, are to fix the tilde key when using Linux (on a Macbook Pro) and to run powertop in order to keep my laptop battery happy.&lt;/p&gt;

&lt;p&gt;Most forum posts I‚Äôve seen state that all you need to do is &lt;code class=&quot;highlighter-rouge&quot;&gt;sudo nano /etc/rc.local&lt;/code&gt; and add whatever commands you want. Great! Turns out that I‚Äôd been blissfully unaware for quite a while now that it wasn‚Äôt actually working.&lt;/p&gt;

&lt;p&gt;Each time, I would accidentally overwrite &lt;code class=&quot;highlighter-rouge&quot;&gt;rc.local&lt;/code&gt; instead of appending to it. Woops!&lt;/p&gt;

&lt;p&gt;Keep in mind I‚Äôm like an alcoholic when it comes to trying out Linux distros so I never stuck with one long enough to take much notice.&lt;/p&gt;

&lt;p&gt;I looked into it today though and it turns out I was missing a shebang at the top of the file and some proper file permissions.&lt;/p&gt;

&lt;p&gt;To make the file executable, we can simply run &lt;code class=&quot;highlighter-rouge&quot;&gt;sudo chmod +x /etc/rc.local&lt;/code&gt; in the terminal.&lt;/p&gt;

&lt;p&gt;As for the file itself, mine looks like this at the moment:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/sh -e&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# Fix tilde key on startup&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;0 &amp;gt; /sys/module/hid_apple/parameters/iso_layout

&lt;span class=&quot;c&quot;&gt;# Auto tune battery life&lt;/span&gt;
powertop --auto-tune

&lt;span class=&quot;nb&quot;&gt;exit &lt;/span&gt;0&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Those two scripts should &lt;code class=&quot;highlighter-rouge&quot;&gt;exit&lt;/code&gt; with a status of &lt;code class=&quot;highlighter-rouge&quot;&gt;0&lt;/code&gt; anyway but there‚Äôs no harm in making sure.&lt;/p&gt;

&lt;p&gt;As promised, here are some resources if you want to read more about &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/rc.local&lt;/code&gt;:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.unix.com/man-page/All/8/rc.local/&quot;&gt;rc.local manpage&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://bencane.com/2011/12/30/when-its-ok-and-not-ok-to-use-rc-local/&quot;&gt;When it‚Äôs ok and not ok to use rc.local&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.freebsd.org/cgi/man.cgi?query=rc.local&amp;amp;sektion=8&quot;&gt;rc.local freebsd manpage&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://unix.stackexchange.com/questions/49626/purpose-and-typical-usage-of-etc-rc-local&quot;&gt;Purpose and typical usage of /etc/rc.local&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><category term="Linux" /><category term="Snippets" /><summary>Huh? Oh no, this is more for me than you</summary></entry><entry><title>Ambulance WiFi Hotspots</title><link href="http://localhost:4000/2017/ambulance/" rel="alternate" type="text/html" title="Ambulance WiFi Hotspots" /><published>2017-01-01T00:00:00+13:00</published><updated>2017-01-01T00:00:00+13:00</updated><id>http://localhost:4000/2017/ambulance</id><content type="html" xml:base="http://localhost:4000/2017/ambulance/">&lt;p&gt;This actually happened a few days ago but pbbt, everyone is on holiday and writing is hard!&lt;/p&gt;

&lt;p&gt;There were two ambulances at our neighbours place and interestingly enough, they apparently emit their own WiFi networks. At first I thought it was a coincidence until the second ambulance (and SSID) appeared so I had a look.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/ambulance/scan-left.png&quot;&gt;&lt;img src=&quot;/assets/img/ambulance/scan-left.png&quot; alt=&quot;Left half of a network scan&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Nothing much stands out here. They‚Äôre both using WPA2 Personal and 802.11b/g/n, although they‚Äôre on different channels. You wouldn‚Äôt want a gathering of ambulance WiFi networks interfering with each other, right?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/ambulance/scan-right.png&quot;&gt;&lt;img src=&quot;/assets/img/ambulance/scan-right.png&quot; alt=&quot;Right half of a network scan&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Everything else is the same but interestingly, for New Zealand ambulances, their country code is set to American! I guess they were just left using default factory settings?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/ambulance/stumbler.png&quot;&gt;&lt;img src=&quot;/assets/img/ambulance/stumbler.png&quot; alt=&quot;A slightly more informative scan&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I did a bit more searching around the use of wireless networks in New Zealand ambulances and it took me beyond Page 1 of Google‚Ä¶&lt;/p&gt;

&lt;p&gt;The first interesting bit was from &lt;a href=&quot;http://www.cio.co.nz/article/557698/mission-critical-ict-st-john-nz/&quot;&gt;this interview&lt;/a&gt; by CIO back in October 2014.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;‚ÄúWe‚Äôre looking at putting wireless technology into every ambulance station, so that while the ambulance is in transit it will be using the 3G network. Then, as it drives into the station, the wireless will take over.‚Äù&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;So, the ambulances have the ability to switch between 3G and WiFi on the fly which makes sense.&lt;/p&gt;

&lt;p&gt;The other informative piece was from &lt;a href=&quot;https://www.lightwire.co.nz/case-studies/st-john-hq-thames/&quot;&gt;a case study&lt;/a&gt; by Lightwire where they detail systems upgrades they aided with in October 2015&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;‚ÄúWhen an ambulance comes back from a call out, staff sync this information, which on the old system added to the strain.‚Äù&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;It isn‚Äôt stated outright but I can assume from those two quotes that the WiFi network being broadcast syncs patient data back to HQ once they arrive back at their respective stations.&lt;/p&gt;

&lt;p&gt;Well, that certainly more interesting than I expected. I didn‚Äôt get a chance to gather much information when the ambulances were there. I popped on a scan and then got sidetracked with troubleshooting my parents desktop. Despite that, it looks like this was another successful round of detective work!&lt;/p&gt;</content><category term="Networking" /><category term="WiFi" /><summary>If it was just a little bit closer...</summary></entry><entry><title>Installing Arch on a Macbook Pro</title><link href="http://localhost:4000/2016/arch/" rel="alternate" type="text/html" title="Installing Arch on a Macbook Pro" /><published>2016-12-19T00:00:00+13:00</published><updated>2016-12-19T00:00:00+13:00</updated><id>http://localhost:4000/2016/arch</id><content type="html" xml:base="http://localhost:4000/2016/arch/">&lt;p&gt;The basic steps towards installing Arch Linux on a Macbook Pro&lt;/p&gt;

&lt;p&gt;As a bit of fun, I attempted to try installing Arch Linux on my Macbook Pro.&lt;/p&gt;

&lt;p&gt;Originally, this didn‚Äôt work but I‚Äôve since figured out what I was missing (and I‚Äôve noted it below)&lt;/p&gt;

&lt;p&gt;This will only be enough for the base install though. You can follow the Arch wiki if you want to go through with installing Gnome but I haven‚Äôt decided on a desktop environment I like yet.&lt;/p&gt;

&lt;p&gt;When I do, I‚Äôll probably do a longer post explaining the steps.&lt;/p&gt;

&lt;p&gt;The disk partitioning likely isn‚Äôt the most efficient use of space so be sure to look up some other guides too.&lt;/p&gt;

&lt;h3 id=&quot;keyboard&quot;&gt;Keyboard&lt;/h3&gt;

&lt;p&gt;First things first:&lt;/p&gt;

&lt;p&gt;By default, your &lt;code class=&quot;highlighter-rouge&quot;&gt;~&lt;/code&gt; key will spit out a &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;&lt;/code&gt; so we need to fix that&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;touch /etc/rc.local
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;echo 0 &amp;gt; /sys/module/hid_apple/parameters/iso_layout&quot;&lt;/span&gt; &amp;gt; /etc/rc.local
&lt;span class=&quot;nb&quot;&gt;source&lt;/span&gt; /etc/rc.local&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This part pretty much goes for any Linux OS on a Macbook.&lt;/p&gt;

&lt;h3 id=&quot;connect-to-wifi&quot;&gt;Connect to WiFi&lt;/h3&gt;

&lt;p&gt;Next up, we need to connect to WiFi. You can manually use things like the &lt;code class=&quot;highlighter-rouge&quot;&gt;wpa_supplicant.conf&lt;/code&gt; file but the built in &lt;code class=&quot;highlighter-rouge&quot;&gt;wifi-menu&lt;/code&gt; command is way easier.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;wifi-menu&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Once you‚Äôve set up a profile and connected, you can check that you have an IP address assigned with &lt;code class=&quot;highlighter-rouge&quot;&gt;ip addr&lt;/code&gt; and then ping google to check that you‚Äôre receiving data with &lt;code class=&quot;highlighter-rouge&quot;&gt;ping google.com -c 3&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&quot;partitions&quot;&gt;Partitions&lt;/h3&gt;

&lt;p&gt;This part was a huge pain in the butt for me&lt;/p&gt;

&lt;p&gt;First we need to get the location of your primary hard drive. You can run &lt;code class=&quot;highlighter-rouge&quot;&gt;fdisk -l&lt;/code&gt; to list all of your hard drives. For me, my primary drive is &lt;code class=&quot;highlighter-rouge&quot;&gt;/dev/sdb&lt;/code&gt; which may differ for you.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Note&lt;/strong&gt;: &lt;em&gt;_Going forward, I‚Äôll be using &lt;code class=&quot;highlighter-rouge&quot;&gt;/dev/sdb&lt;/code&gt; but if it‚Äôs different for you, replace it with your own drive location_&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;For myself, I have a 250GB SSD but you‚Äôll have to decide what you‚Äôre after yourself.&lt;/p&gt;

&lt;p&gt;The setup I decided on was a 500MB EFI boot partition, 20GB root partition, 7.5GB swap partition and the remainder assigned to &lt;code class=&quot;highlighter-rouge&quot;&gt;/home&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;First step is to run &lt;code class=&quot;highlighter-rouge&quot;&gt;parted /dev/sdb&lt;/code&gt; so we can specify how we want to set up our partition&lt;/p&gt;

&lt;p&gt;EDIT: &lt;strong&gt;NOTE: File locations like [/boot] are just for reference! They are not part of the commands&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Funnily enough, I was using my own guide to install Arch on an Intel NUC and fell into that trap. I‚Äôve also changed &lt;code class=&quot;highlighter-rouge&quot;&gt;mklabel msdos&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;mklabel gpt&lt;/code&gt; because I forgot to alter my notes.&lt;/p&gt;

&lt;p&gt;As far as the different between UEFI and BIOS requirements, I‚Äôm still learning but you‚Äôd use GPT with UEFI in order to be able to make an EFI partition?&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;mklabel gpt
mkpart ESP fat32 1MiB 500MiB &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/boot]
&lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;1 boot on
mkpart primary ext4 500MiB 20.5GiB &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/]
mkpart primary linux-swap 20.5GiB 28GiB &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;swap]
mkpart primary ext4 28GiB 100% &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/home]
Ctrl + C&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Once that‚Äôs done, checking &lt;code class=&quot;highlighter-rouge&quot;&gt;fdisk -l&lt;/code&gt; again should show the partition setup like so:&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Device&lt;/th&gt;
      &lt;th&gt;Size&lt;/th&gt;
      &lt;th&gt;Type&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;/dev/sdb1&lt;/td&gt;
      &lt;td&gt;499M&lt;/td&gt;
      &lt;td&gt;EFI&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;/dev/sdb2&lt;/td&gt;
      &lt;td&gt;20G&lt;/td&gt;
      &lt;td&gt;Linux&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;/dev/sdb3&lt;/td&gt;
      &lt;td&gt;7.5G&lt;/td&gt;
      &lt;td&gt;Linux swap / Solaris&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;/dev/sdb4&lt;/td&gt;
      &lt;td&gt;205.8G&lt;/td&gt;
      &lt;td&gt;Linux&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Now that we‚Äôve specificied the partitions, we actually need to make some file systems for them and activate the swap partition:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;mkfs.vfat -F32 /dev/sdb1 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/boot]
mkfs.ext4 /dev/sdb2 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/]
mkswap /dev/sdb3 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;swap]
swapon /dev/sdb3
mkfs.ext4 /dev/sdb4 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/home]&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;mounting-the-filesystems&quot;&gt;Mounting the filesystems&lt;/h3&gt;

&lt;p&gt;With our filesystems created and swap partition activated, we can mount the filesystems in order to start installing our operating system&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;mount /dev/sdb2 /mnt
mkdir -p /mnt/boot
mount /dev/sdb1 /mnt/boot
mkdir -p /mnt/home
mount /dev/sdb4 /mnt/home&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;For anyone wondering why they‚Äôve never seen &lt;code class=&quot;highlighter-rouge&quot;&gt;/mnt&lt;/code&gt; before, it doesn‚Äôt actually exist. In the end, it just resolves to &lt;code class=&quot;highlighter-rouge&quot;&gt;/&lt;/code&gt;. For example, &lt;code class=&quot;highlighter-rouge&quot;&gt;/mnt/home&lt;/code&gt; just becomes &lt;code class=&quot;highlighter-rouge&quot;&gt;/home&lt;/code&gt; and so on.&lt;/p&gt;

&lt;h3 id=&quot;installing-base-packages&quot;&gt;Installing base packages&lt;/h3&gt;

&lt;p&gt;With the filesystems mounted, it‚Äôs time to install the base Arch packages&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;pacstrap /mnt base base-devel&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;fiddly-setup-bits-and-pieces&quot;&gt;Fiddly setup bits and pieces&lt;/h3&gt;

&lt;p&gt;This is the last little step before we can get a &lt;code class=&quot;highlighter-rouge&quot;&gt;bash&lt;/code&gt; sh running which should make terminal fans feel more comfortable.&lt;/p&gt;

&lt;p&gt;We‚Äôll want to generate an fstab template to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/fstab&lt;/code&gt; for later so we can name our filesystems and then use &lt;code class=&quot;highlighter-rouge&quot;&gt;arch-chroot&lt;/code&gt; to get bash working&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;genfstab -U /mnt &amp;gt;&amp;gt; /mnt/etc/fstab
arch-chroot /mnt /bin/bash&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Next we‚Äôll generate our locale. When you edit &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/locale.gen&lt;/code&gt;, you‚Äôll see every available locale and you just need to uncomment your respective one. For me, it‚Äôs &lt;code class=&quot;highlighter-rouge&quot;&gt;en_NZ.UTF-8&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;For you, it‚Äôll just be whichever matches your respective language and country code. You‚Äôll likely want to choose the &lt;code class=&quot;highlighter-rouge&quot;&gt;UTF-8&lt;/code&gt; option if there are multiple choices.&lt;/p&gt;

&lt;p&gt;Generate locale&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;nano /etc/locale.gen
locale-gen
&lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LANG&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;={&lt;/span&gt;locale&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &amp;gt; /etc/locale.conf&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;I hope it goes without saying that &lt;strong&gt;{locale} is a placeholder. Swap it with your own locale eg: &lt;code class=&quot;highlighter-rouge&quot;&gt;LANG=en_NZ.UTF-8&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Next, we‚Äôll be setting our timezones. Again, just swap NZ for your country code.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;ln -sf /usr/share/zoneinfo/NZ /etc/localtime
hwclock --systohc&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;fix-boot-order-and-optimise-ssd&quot;&gt;Fix boot order and optimise SSD&lt;/h3&gt;

&lt;p&gt;This part can be a bit confusing. By default, in your &lt;code class=&quot;highlighter-rouge&quot;&gt;fstab&lt;/code&gt; file, the boot order of your partitions may possibly be the wrong way around.&lt;/p&gt;

&lt;p&gt;For me, &lt;code class=&quot;highlighter-rouge&quot;&gt;/dev/sdb1&lt;/code&gt; should be set to &lt;code class=&quot;highlighter-rouge&quot;&gt;01&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;/dev/sdb2&lt;/code&gt; should be set to &lt;code class=&quot;highlighter-rouge&quot;&gt;02&lt;/code&gt; but they were the wrong way around.&lt;/p&gt;

&lt;p&gt;You‚Äôll want to edit fstab and make sure they‚Äôre set correctly.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;nano /etc/fstab&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;For some optional optimisation (no idea what, I just saw this somewhere along the way), you can add &lt;code class=&quot;highlighter-rouge&quot;&gt;discard&lt;/code&gt; to the line &lt;code class=&quot;highlighter-rouge&quot;&gt;rw,relatime,data=ordered&lt;/code&gt; on the &lt;code class=&quot;highlighter-rouge&quot;&gt;/home&lt;/code&gt; partition in your &lt;code class=&quot;highlighter-rouge&quot;&gt;fstab&lt;/code&gt; file.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;rw,relatime,data&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;ordered,discard&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;enable-fan-and-temp-sensor-kernel-modules&quot;&gt;Enable fan and temp sensor kernel modules&lt;/h3&gt;

&lt;p&gt;Apparently the fan and temperature sensor kernel modules aren‚Äôt enabled by default.&lt;/p&gt;

&lt;p&gt;Easily fixed by adding &lt;code class=&quot;highlighter-rouge&quot;&gt;coretemp&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;applesmc&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/modules&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;nano /etc/modules&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;create-a-hostname-for-your-computer&quot;&gt;Create a hostname for your computer&lt;/h3&gt;

&lt;p&gt;The hostname is what your computer will be referred to as. If you‚Äôve seen &lt;code class=&quot;highlighter-rouge&quot;&gt;username@computername&lt;/code&gt; in terminals before, the computername section is what this hostname will be.&lt;/p&gt;

&lt;p&gt;All you need to do is edit it and add your desired hostname. Just the name and nothing else.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;nano /etc/hostname&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;You‚Äôll also want to add the &lt;code class=&quot;highlighter-rouge&quot;&gt;hostname&lt;/code&gt; after both &lt;code class=&quot;highlighter-rouge&quot;&gt;localhost&lt;/code&gt; instances in your hosts file&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;nano /etc/hosts&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;make-initial-kernel--environment-to-open-partitions&quot;&gt;Make initial kernel / environment to open partitions&lt;/h3&gt;

&lt;p&gt;Admittedly, this is where I get a bit lost but I believe we‚Äôre generating the Linux kernel for our OS? I don‚Äôt even know what I‚Äôm talking about but it‚Äôs the next step&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;mkinitcpio -p linux&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;set-root-password&quot;&gt;Set root password&lt;/h3&gt;

&lt;p&gt;Well, simply put, it‚Äôs the password used for the root account. You know, for using with &lt;code class=&quot;highlighter-rouge&quot;&gt;sudo&lt;/code&gt; and what not.&lt;/p&gt;

&lt;p&gt;It‚Äôs as simple as running one command and entering in the password you‚Äôd like&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;passwd&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;preserve-lan-support-for-later&quot;&gt;Preserve LAN support for later&lt;/h3&gt;

&lt;p&gt;I don‚Äôt recall the exact reason for this but I suppose it‚Äôs assumed after the upcoming restart that LAN support will be lost. I never had this issue but there‚Äôs no hard in it anyway.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;pacman -S dhcpcd
systemctl &lt;span class=&quot;nb&quot;&gt;enable &lt;/span&gt;dhcpcd&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;install-bootloader-for-macbook-pro&quot;&gt;Install bootloader for Macbook Pro&lt;/h3&gt;

&lt;p&gt;Here is where things went sideways for me. As far as I‚Äôm aware, these are the correct commands for installing the UEFI bootloader (I never tried using grub2 which may fix this issue)&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;pacman -S dosfstools
bootctl --path&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/boot install&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;create-a-boot-entry&quot;&gt;Create a boot entry&lt;/h3&gt;

&lt;p&gt;We need to make a new entry in the boot segment&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;nano /boot/loader/entries/arch.conf&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;and then configure it by entering the following&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;title Arch Linux
linux /vmlinuz-linux
initrd /initramfs-linux.img
options &lt;span class=&quot;nv&quot;&gt;root&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/dev/sda2 rw &lt;span class=&quot;nv&quot;&gt;elevator&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;deadline quiet splash &lt;span class=&quot;nv&quot;&gt;resume&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/dev/sda3 &lt;span class=&quot;nv&quot;&gt;nmi_watchdog&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;NOTE&lt;/strong&gt;: Yes, I reference &lt;code class=&quot;highlighter-rouge&quot;&gt;sda&lt;/code&gt; and not &lt;code class=&quot;highlighter-rouge&quot;&gt;sdb&lt;/code&gt; here. For whatever reason, the drive swaps to being &lt;code class=&quot;highlighter-rouge&quot;&gt;/dev/sda&lt;/code&gt; once the install is completed and you reboot. This is what originally gave me trouble. I was referencing &lt;code class=&quot;highlighter-rouge&quot;&gt;/dev/sdb&lt;/code&gt; which didn‚Äôt exist anymore.&lt;/p&gt;

&lt;p&gt;Once that‚Äôs all done, we then set Arch Linux as our default OS for loading like so&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;default arch&quot;&lt;/span&gt; &amp;gt; /boot/loader/loader.conf&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;and reboot in order to carry on with the rest of the setup (Desktop environment and what not)&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;nb&quot;&gt;exit
&lt;/span&gt;reboot&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;At this point, rebooting should give you the basics of an operating system but it won‚Äôt be enough to use on a daily basis.&lt;/p&gt;

&lt;p&gt;The &lt;a href=&quot;https://help.ubuntu.com/community/MacBookPro&quot;&gt;Ubuntu&lt;/a&gt; and &lt;a href=&quot;https://wiki.archlinux.org/index.php/MacBook&quot;&gt;Arch&lt;/a&gt; wikis are good resources on where to go next as well as Google of course.&lt;/p&gt;</content><category term="Arch" /><category term="Experiments" /><category term="Linux" /><summary>Aww hell, it&#39;s brok-, wait no, we&#39;re fine</summary></entry><entry><title>Dear China</title><link href="http://localhost:4000/2016/china/" rel="alternate" type="text/html" title="Dear China" /><published>2016-12-08T00:00:00+13:00</published><updated>2016-12-08T00:00:00+13:00</updated><id>http://localhost:4000/2016/china</id><content type="html" xml:base="http://localhost:4000/2016/china/">&lt;p&gt;Seeing as I‚Äôm currently ‚Äúfunemployed‚Äù with my previous contract having ended toward the end of last week, I‚Äôve been in the bad habit of staying up late. Well, staying up early rather.&lt;/p&gt;

&lt;p&gt;The router in our flat had cut out one night at about 4am while I was reading up on some stuff so I thought nothing much of it and went to bed.&lt;/p&gt;

&lt;p&gt;The next night, it happened again which I thought was odd timing so for once, I actually remembered that the router would be saving logs somewhere.&lt;/p&gt;

&lt;h2 id=&quot;what-the-heck-is-all-this&quot;&gt;What the heck is all this?&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/china/logs.png&quot;&gt;&lt;img src=&quot;/assets/img/china/logs.png&quot; alt=&quot;The logs from our Nighthawk router&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Well, holy shit. That‚Äôs a lot of pings.&lt;/p&gt;

&lt;p&gt;I will point out that &lt;code class=&quot;highlighter-rouge&quot;&gt;202.78.144.60&lt;/code&gt; is the static IP address for our router (and the IP address from which this blog is served) so it doesn‚Äôt count but everything else was completely foreign to me.&lt;/p&gt;

&lt;p&gt;My first assumption was that it was probably some misconfigured IoT device somewhere in the world that had been infected.&lt;/p&gt;

&lt;p&gt;I couldn‚Äôt say for sure but it really wouldn‚Äôt surprise me after seeing how many devices earlier this year had been infected by &lt;a href=&quot;https://en.wikipedia.org/wiki/Mirai_(malware)&quot;&gt;Mirai&lt;/a&gt; in the two large DDoS attacks earlier this year.&lt;/p&gt;

&lt;h2 id=&quot;lets-find-out-some-more-info&quot;&gt;Let‚Äôs find out some more info&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/china/abuseipdb.png&quot;&gt;&lt;img src=&quot;/assets/img/china/abuseipdb.png&quot; alt=&quot;A screenshot of Abuse IPDB showing the source as being from China&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;All of the addresses that I had a look at live somewhere in China. This one is allegedly in &lt;a href=&quot;https://en.wikipedia.org/wiki/Nanjing&quot;&gt;Nanjing&lt;/a&gt; while another was in &lt;a href=&quot;https://en.wikipedia.org/wiki/Shenzhen&quot;&gt;Shenzhen&lt;/a&gt; but who knows what effect the &lt;a href=&quot;https://en.wikipedia.org/wiki/Great_Firewall&quot;&gt;Great Firewall&lt;/a&gt; could be having on geolocation.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/china/whois.png&quot;&gt;&lt;img src=&quot;/assets/img/china/whois.png&quot; alt=&quot;The whois segment from Abuse IPDB&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The whois segment gave some possible contact details so I tried sending them a nice friendly email to ask that they find whatever user or device is sending out these pings and disable it.&lt;/p&gt;

&lt;h2 id=&quot;can-we-ask-them-to-stop&quot;&gt;Can we ask them to stop?&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/china/bounceback.png&quot;&gt;&lt;img src=&quot;/assets/img/china/bounceback.png&quot; alt=&quot;The email I sent bounced back&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Probably not very surprising but two of the three addresses I tried resulted in failed attempts. Email concepts aren‚Äôt my strong point but it seems that they don‚Äôt have any &lt;a href=&quot;https://en.wikipedia.org/wiki/Sender_Policy_Framework&quot;&gt;SPF&lt;/a&gt; records configured.&lt;/p&gt;

&lt;p&gt;Well, next stop is just talking to the mail server itself and seeing what it says about the email addresses in question!&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/china/relay-denied.png&quot;&gt;&lt;img src=&quot;/assets/img/china/relay-denied.png&quot; alt=&quot;A terminal window with the mail server saying Relay access denied&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I remembered a neat trick I learnt a week or two back where you can get the mail records for a domain using &lt;code class=&quot;highlighter-rouge&quot;&gt;nslookup -q=MX [domain]&lt;/code&gt; and then just manually connect to them using &lt;code class=&quot;highlighter-rouge&quot;&gt;telnet [mail server] [port (usually 25)]&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;In particular, I just use it for seeing if email addresses exist or not (eg; for job applications) without having to actually send off an email.&lt;/p&gt;

&lt;p&gt;In this case, it came in handy for seeing that the relay itself just didn‚Äôt want anything at all to do with me. I‚Äôm going to assume it‚Äôs because I‚Äôm trying to access it from outside of China but that‚Äôs 100% pure speculation and I have no idea what &lt;code class=&quot;highlighter-rouge&quot;&gt;Relay Access Denied&lt;/code&gt; means beyond what it says on the tin.&lt;/p&gt;

&lt;h2 id=&quot;what-else-can-we-find-out&quot;&gt;What else can we find out?&lt;/h2&gt;

&lt;p&gt;Well, the last thing to try is good ol‚Äô &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt;. Admittedly, it was the first thing I tried (most of this post is out of chronological order) but it also was the most surprising.&lt;/p&gt;

&lt;p&gt;The first scan I did took 3 minutes and didn‚Äôt show much. Next, I ran two OS scans (&lt;code class=&quot;highlighter-rouge&quot;&gt;sudo nmap -O [ip]&lt;/code&gt;), one on my own computer and one from a much faster &lt;a href=&quot;http://amazonaws.com&quot;&gt;AWS&lt;/a&gt; server.&lt;/p&gt;

&lt;p&gt;The AWS server finished first but didn‚Äôt have much to show. The scan on my own computer took 30(!!!) minutes to complete. I know routing can be a bit slow with the firewall and all but holy heck!&lt;/p&gt;

&lt;p&gt;All I can say is, the results I got back were something I never expected&lt;/p&gt;

&lt;h2 id=&quot;get-ready-for-a-wall-of-text-in-image-form&quot;&gt;Get ready for a wall of text (in image form)&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/china/nmap-p1.png&quot;&gt;&lt;img src=&quot;/assets/img/china/nmap-p1.png&quot; alt=&quot;Part 1 of the nmap scan&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/china/nmap-p2.png&quot;&gt;&lt;img src=&quot;/assets/img/china/nmap-p2.png&quot; alt=&quot;Part 2 of the nmap scan&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/china/nmap-p3.png&quot;&gt;&lt;img src=&quot;/assets/img/china/nmap-p3.png&quot; alt=&quot;Part 3 of the nmap scan&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/china/nmap-p4.png&quot;&gt;&lt;img src=&quot;/assets/img/china/nmap-p4.png&quot; alt=&quot;Part 4 of the nmap scan&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/china/nmap-p5.png&quot;&gt;&lt;img src=&quot;/assets/img/china/nmap-p5.png&quot; alt=&quot;Part 5 of the nmap scan&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Seeing as I‚Äôm a hobbyist, I don‚Äôt really use &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; that much but I‚Äôve never seen so many open ports in my life!&lt;/p&gt;

&lt;p&gt;Interestingly enough, there‚Äôs a heap of ports lower than &lt;code class=&quot;highlighter-rouge&quot;&gt;1024&lt;/code&gt; open as well which generally require admin privileges to bind to.&lt;/p&gt;

&lt;p&gt;Apparently, the services listed are just what &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; associated with each port but isn‚Äôt necessarily what is running out of them. As far as learning about services though, this seems like a decent list to run off of.&lt;/p&gt;

&lt;h2 id=&quot;get-us-outta-here-scotty&quot;&gt;Get us outta here, scotty&lt;/h2&gt;

&lt;p&gt;While the scan points to possibly a network switch, router, printer or even IoT thermometer of some sort, there‚Äôs not really much I can do about it unfortunately.&lt;/p&gt;

&lt;p&gt;In the grand scheme of things though, this is likely happening to every other device connected to the internet anyway and it doesn‚Äôt really doing any harm.&lt;/p&gt;

&lt;p&gt;It does make me wonder how many devices there must be to provide full coverage against my address almost every minute of the day when there‚Äôs just under 4.3 billion other IPv4 address that they could be hassling!&lt;/p&gt;</content><category term="Networking" /><category term="Routers" /><summary>Can you please stop? Thanks</summary></entry><entry><title>RaGaPa? What‚Äôs that?</title><link href="http://localhost:4000/2016/ragapa/" rel="alternate" type="text/html" title="RaGaPa? What&#39;s that?" /><published>2016-11-30T00:00:00+13:00</published><updated>2016-11-30T00:00:00+13:00</updated><id>http://localhost:4000/2016/ragapa</id><content type="html" xml:base="http://localhost:4000/2016/ragapa/">&lt;p&gt;So, I‚Äôm sitting at the library using the public WiFi and I visit an unsecured site.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/ragapa/mot-injection.png&quot;&gt;&lt;img src=&quot;/assets/img/ragapa/mot-injection.png&quot; alt=&quot;Ministry of Transport face with injection in front of it&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Bam, injected ad frame. What?!? I run Common Sense 2016, the most up to date antivirus available!&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/ragapa/thingsimade-injection.png&quot;&gt;&lt;img src=&quot;/assets/img/ragapa/thingsimade-injection.png&quot; alt=&quot;Even my own site had it since I disabled https&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Even my own site is suffering from this rather ugly defacement! Bah, and people think I‚Äôm silly for enabling https even on my static sites. If a site has it enabled, these ads can‚Äôt insert themselves midway.&lt;/p&gt;

&lt;p&gt;I realised later on that I had removed &lt;a href=&quot;https://chrome.google.com/webstore/detail/ublock-origin/cjpalhdlnbpafiamejdnhcphjbkeiagm?hl=en&quot;&gt;uBlock Origin&lt;/a&gt; while testing out some different extensions, and forgotten to reinstall it, which is why I‚Äôd never seen these injections before.&lt;/p&gt;

&lt;h2 id=&quot;if-its-not-me-maybe-its-the-network&quot;&gt;If it‚Äôs not me, maybe it‚Äôs the network!&lt;/h2&gt;

&lt;p&gt;I had a look in my extensions. Nothing out of place there. A quick poke around the most obvious places turned up zilch so perhaps it was someone, or something on the network?&lt;/p&gt;

&lt;p&gt;I spun up &lt;a href=&quot;https://wireshark.org&quot;&gt;Wireshark&lt;/a&gt; and watched the network spew out heaps of requests. It was a public city WiFi after all but thankfully, you can filter by &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; to gain some more clarity.&lt;/p&gt;

&lt;p&gt;Oooh, what‚Äôs that?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/ragapa/wireshark.png&quot;&gt;&lt;img src=&quot;/assets/img/ragapa/wireshark.png&quot; alt=&quot;The Wireshark captures from Wellington Library&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Hmm, &lt;code class=&quot;highlighter-rouge&quot;&gt;GET /api/adscript.jsp&lt;/code&gt;? That looks promising.&lt;/p&gt;

&lt;p&gt;Perhaps an infected device is serving it up? What if it‚Äôs someone hijacking unsecured requests and inserting their own monetisation? I gotta know more!&lt;/p&gt;

&lt;p&gt;Thanks to my rookie skills with nmap, I remembered that I could run a scan on it, not just for open ports but also details about its OS as well.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/ragapa/cbdfree-nmap.png&quot;&gt;&lt;img src=&quot;/assets/img/ragapa/cbdfree-nmap.png&quot; alt=&quot;nmap output from the Wellington Library scan&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Too many fingerprints match this host to give specific OS details.&lt;/code&gt; Well, so much for that approach.&lt;/p&gt;

&lt;p&gt;Maybe the actual ad script itself can give me some clues?&lt;/p&gt;

&lt;h2 id=&quot;its-usually-quicker-if-you-look-at-whats-right-in-front-of-you&quot;&gt;It‚Äôs usually quicker if you look at what‚Äôs right in front of you&lt;/h2&gt;

&lt;p&gt;I loaded up a non-secure site and poked around the DOM.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/ragapa/script.png&quot;&gt;&lt;img src=&quot;/assets/img/ragapa/script.png&quot; alt=&quot;Developer tools in Google Chrome showing injected Javascript&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Oh‚Ä¶ That address has &lt;a href=&quot;http://www.citylink.co.nz/&quot;&gt;Citylink Wellington&lt;/a&gt; in it who run the actual network itself. I guess it‚Äôs nothing malicious after all but still a pain in the ass.&lt;/p&gt;

&lt;p&gt;I kept coming across &lt;code class=&quot;highlighter-rouge&quot;&gt;ragapa&lt;/code&gt; references, such as &lt;code class=&quot;highlighter-rouge&quot;&gt;div class=ragapaBottomImage&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;script src=http://adapi.ragapa.com&lt;/code&gt; but in wanting to play with Wireshark, I skipped the obvious path of just searching the name. How is that any fun though!&lt;/p&gt;

&lt;p&gt;It didn‚Äôt take me long before I found an article about RaGaPa.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/ragapa/ragapa-article.png&quot;&gt;&lt;img src=&quot;/assets/img/ragapa/ragapa-article.png&quot; alt=&quot;An article about the RaGaPa ad injection device&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;They‚Äôre a company who provide devices that inject ads into WiFi hotspots. In this case, the entire city wide WiFi hotspot called &lt;code class=&quot;highlighter-rouge&quot;&gt;cbdfree&lt;/code&gt;.&lt;/p&gt;

&lt;h2 id=&quot;i-want-to-make-it-go-away&quot;&gt;I want to make it go away.&lt;/h2&gt;

&lt;p&gt;Well, the good news is that there are ad blockers for exactly that! Chances are, if you use Adblock, you‚Äôre using Easylist which was merged with a list maintained by New Zealand‚Äôs very own &lt;a href=&quot;https://fanboy.co.nz/&quot;&gt;Fanboy List&lt;/a&gt;. He actually had RaGaPa‚Äôs site in his list so more or less every instance of Adblock will block it by default.&lt;/p&gt;</content><category term="Networking" /><category term="Wellington" /><category term="WiFi" /><summary>Eww, adverts</summary></entry><entry><title>Railtalk</title><link href="http://localhost:4000/2016/railtalk/" rel="alternate" type="text/html" title="Railtalk" /><published>2016-10-06T00:00:00+13:00</published><updated>2016-10-06T00:00:00+13:00</updated><id>http://localhost:4000/2016/railtalk</id><content type="html" xml:base="http://localhost:4000/2016/railtalk/">&lt;p&gt;The other day, I was at the Wellington Train Station and I noticed something funny was up with the monitors that display the timetables.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/railtalk/announcements.jpg&quot;&gt;&lt;img src=&quot;/assets/img/railtalk/announcements.jpg&quot; alt=&quot;The Metlink schedule of upcoming automated announcements&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Yeah! Those totally look like commands that a program would read! I would call it a rare glimpse into how they automate the voicing.&lt;/p&gt;

&lt;p&gt;Here‚Äôs another photo from shortly after.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/railtalk/railtalk.jpg&quot;&gt;&lt;img src=&quot;/assets/img/railtalk/railtalk.jpg&quot; alt=&quot;A photo of the RailTalk application name&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;You‚Äôll notice a macOS program called RailTalk. For the life of me, I can‚Äôt find any information about it.&lt;/p&gt;

&lt;p&gt;Out of curosity, I emailed &lt;a href=&quot;http://metlink.org.nz&quot;&gt;Metlink&lt;/a&gt; to see if they could tell me more about it.&lt;/p&gt;

&lt;p&gt;It was only a day ago so I haven‚Äôt heard anything yet but I‚Äôll keep you updated.&lt;/p&gt;

&lt;h3 id=&quot;update-1&quot;&gt;Update 1&lt;/h3&gt;

&lt;p&gt;The Metlink Service Centre replied, informing me that the train operator &lt;a href=&quot;http://transdevwellington.co.nz&quot;&gt;Transdev&lt;/a&gt; would be able to shed some more light on my question.&lt;/p&gt;

&lt;p&gt;It‚Äôs currently Saturday so it‚Äôs unlikely I‚Äôll have any updates but at least we‚Äôre headed in the right direction!&lt;/p&gt;

&lt;h3 id=&quot;update-2&quot;&gt;Update 2&lt;/h3&gt;

&lt;p&gt;I‚Äôm just doing an update for this while I move my blog across to its current platform.&lt;/p&gt;

&lt;p&gt;I never heard back from Transdev, even though they sent an automated email saying I would hear a response within 5 days.&lt;/p&gt;</content><category term="Curiosity" /><category term="Wellington" /><summary>That doesn&#39;t look right!?</summary></entry></feed>
