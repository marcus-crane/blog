<!DOCTYPE html>
<html lang="en">
  <title>UTF-9000</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="/css/style.css" type="text/css" rel="stylesheet">
<link href='https://fonts.googleapis.com/css?family=Lato:400,300,700' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
<link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/3.0.3/normalize.css" type="text/css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/skeleton/2.0.4/skeleton.css" type="text/css" rel="stylesheet">

<body>
  


  <header>
    <a href="/"><i class="fa fa-chevron-left"></i></a>
    <div id="title">
      <h1>Half installing Arch Linux</h1>
      <h2>I say half because this is broken as heck</h2>
      <h3>December 19, 2016</h3>
    </div>
  </header>





  <div id="wrapper">
    <section class="post">
  <article>
    <h2 id="some-steps-towards-installing-arch-linux-on-a-macbook-pro">Some steps towards installing Arch Linux on a Macbook Pro</h2>

<p>As a bit of fun, I attempted to try installing Arch Linux on my Macbook.</p>

<p>I didn’t actually get there in the end, mainly just because I got fed up (and needed a working OS the next day) but for anyone else interested in making an attempt, here’s what I managed to figure out.</p>

<p>It isn’t the most efficient order of commands either so take it with a grain of salt.</p>

<p>I should also mention that, <strong>this is not comprehensive enough to give you a fully working operating system!</strong></p>

<p>Only use this as reference if you’re invested enough to figure out the rest of the kinks along the way. <strong>I’m not gonna be responsible if you have any issues.</strong></p>

<h4 id="keyboard">Keyboard</h4>

<p>First things first:</p>

<p>By default, your <code class="highlighter-rouge">~</code> key will spit out a <code class="highlighter-rouge">&lt;</code> so we need to fix that</p>

<div class="language-sh highlighter-rouge"><pre class="highlight"><code>touch /etc/rc.local
<span class="nb">echo</span> <span class="s2">"echo 0 &gt; /sys/module/hid_apple/parameters/iso_layout"</span> &gt; /etc/rc.local
<span class="nb">source</span> /etc/rc.local
</code></pre>
</div>

<p>This part pretty much goes for any Linux OS on a Macbook.</p>

<h3 id="connect-to-wifi">Connect to WiFi</h3>

<p>Next up, we need to connect to WiFi. You can manually use things like the <code class="highlighter-rouge">wpa_supplicant.conf</code> file but the built in <code class="highlighter-rouge">wifi-menu</code> command is way easier.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>wifi-menu
</code></pre>
</div>

<p>Once you’ve set up a profile and connected, you can check that you have an IP address assigned with <code class="highlighter-rouge">ip addr</code> and then ping google to check that you’re receiving data with <code class="highlighter-rouge">ping google.com -c 3</code></p>

<h3 id="partitions">Partitions</h3>

<p>This part was a huge pain in the butt for me</p>

<p>First we need to get the location of your primary hard drive. You can run <code class="highlighter-rouge">fdisk -l</code> to list all of your hard drives. For me, my primary drive is <code class="highlighter-rouge">/dev/sdb</code> which may differ for you.</p>

<p><strong>Note</strong>: <em>_Going forward, I’ll be using <code class="highlighter-rouge">/dev/sdb</code> but if it’s different for you, replace it with your own drive location_</em></p>

<p>For myself, I have a 250GB SSD but you’ll have to decide what you’re after yourself.</p>

<p>The setup I decided on was a 500MB EFI boot partition, 20GB root partition, 7.5GB swap partition and the remainder assigned to <code class="highlighter-rouge">/home</code></p>

<p>First step is to run <code class="highlighter-rouge">parted /dev/sdb</code> so we can specify how we want to set up our partition</p>

<p>EDIT: <strong>NOTE: File locations like [/boot] are just for reference! They are not part of the commands</strong></p>

<p>Funnily enough, I was using my own guide to install Arch on an Intel NUC and fell into that trap. I’ve also changed <code class="highlighter-rouge">mklabel msdos</code> to <code class="highlighter-rouge">mklabel gpt</code> because I forgot to alter my notes.</p>

<p>As far as the different between UEFI and BIOS requirements, I’m still learning but you’d use GPT with UEFI in order to be able to make an EFI partition?</p>

<div class="highlighter-rouge"><pre class="highlight"><code>mklabel gpt
mkpart ESP fat32 1MiB 500MiB [/boot]
set 1 boot on
mkpart primary ext4 500MiB 20.5GiB [/]
mkpart primary linux-swap 20.5GiB 28GiB [swap]
mkpart primary ext4 28GiB 100% [/home]
Ctrl + C
</code></pre>
</div>

<p>Once that’s done, checking <code class="highlighter-rouge">fdisk -l</code> again should show the partition setup like so:</p>

<table>
  <thead>
    <tr>
      <th>Device</th>
      <th>Size</th>
      <th>Type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>/dev/sdb1</td>
      <td>499M</td>
      <td>EFI</td>
    </tr>
    <tr>
      <td>/dev/sdb2</td>
      <td>20G</td>
      <td>Linux</td>
    </tr>
    <tr>
      <td>/dev/sdb3</td>
      <td>7.5G</td>
      <td>Linux swap / Solaris</td>
    </tr>
    <tr>
      <td>/dev/sdb4</td>
      <td>205.8G</td>
      <td>Linux</td>
    </tr>
  </tbody>
</table>

<p>Now that we’ve specificied the partitions, we actually need to make some file systems for them and activate the swap partition:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>mkfs.vfat -F32 /dev/sdb1 [/boot]
mkfs.ext4 /dev/sdb2 [/]
mkswap /dev/sdb3 [swap]
swapon /dev/sdb3
mkfs.ext4 /dev/sdb4 [/home]
</code></pre>
</div>

<h3 id="mounting-the-filesystems">Mounting the filesystems</h3>

<p>With our filesystems created and swap partition activated, we can mount the filesystems in order to start installing our operating system</p>

<div class="highlighter-rouge"><pre class="highlight"><code>mount /dev/sdb2 /mnt
mkdir -p /mnt/boot
mount /dev/sdb1 /mnt/boot
mkdir -p /mnt/home
mount /dev/sdb4 /mnt/home
</code></pre>
</div>

<p>For anyone wondering why they’ve never seen <code class="highlighter-rouge">/mnt</code> before, it doesn’t actually exist. In the end, it just resolves to <code class="highlighter-rouge">/</code>. For example, <code class="highlighter-rouge">/mnt/home</code> just becomes <code class="highlighter-rouge">/home</code> and so on.</p>

<h3 id="installing-base-packages">Installing base packages</h3>

<p>With the filesystems mounted, it’s time to install the base Arch packages</p>

<div class="highlighter-rouge"><pre class="highlight"><code>pacstrap /mnt base base-devel
</code></pre>
</div>

<h3 id="fiddly-setup-bits-and-pieces">Fiddly setup bits and pieces</h3>

<p>This is the last little step before we can get a <code class="highlighter-rouge">bash</code> shell running which should make terminal fans feel more comfortable.</p>

<p>We’ll want to generate an fstab template to <code class="highlighter-rouge">/etc/fstab</code> for later so we can name our filesystems and then use <code class="highlighter-rouge">arch-chroot</code> to get bash working</p>

<div class="highlighter-rouge"><pre class="highlight"><code>genfstab -U /mnt &gt;&gt; /mnt/etc/fstab
arch-chroot /mnt /bin/bash
</code></pre>
</div>

<p>Next we’ll generate our locale. When you edit <code class="highlighter-rouge">/etc/locale.gen</code>, you’ll see every available locale and you just need to uncomment your respective one. For me, it’s <code class="highlighter-rouge">en_NZ.UTF-8</code>.</p>

<p>For you, it’ll just be whichever matches your respective language and country code. You’ll likely want to choose the <code class="highlighter-rouge">UTF-8</code> option if there are multiple choices.</p>

<p>Generate locale
<code class="highlighter-rouge">nano /etc/locale.gen</code>
<code class="highlighter-rouge">locale-gen</code>
<code class="highlighter-rouge">echo LANG={locale} &gt; /etc/locale.conf</code></p>

<p>I hope it goes without saying that <strong>{locale} is a placeholder. Swap it with your own locale eg: <code class="highlighter-rouge">LANG=en_NZ.UTF-8</code></strong></p>

<p>Next, we’ll be setting our timezones. Again, just swap NZ for your country code.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>ln -sf /usr/share/zoneinfo/NZ /etc/localtime
hwclock --systohc
</code></pre>
</div>

<h3 id="fix-boot-order-and-optimise-ssd">Fix boot order and optimise SSD</h3>

<p>This part can be a bit confusing. By default, in your <code class="highlighter-rouge">fstab</code> file, the boot order of your partitions may possibly be the wrong way around.</p>

<p>For me, <code class="highlighter-rouge">/dev/sdb1</code> should be set to <code class="highlighter-rouge">01</code> and <code class="highlighter-rouge">/dev/sdb2</code> should be set to <code class="highlighter-rouge">02</code> but they were the wrong way around.</p>

<p>You’ll want to edit fstab and make sure they’re set correctly.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>nano /etc/fstab
</code></pre>
</div>

<p>For some optional optimisation (no idea what, I just saw this somewhere along the way), you can add <code class="highlighter-rouge">discard</code> to the line <code class="highlighter-rouge">rw,relatime,data=ordered</code> on the <code class="highlighter-rouge">/home</code> partition in your <code class="highlighter-rouge">fstab</code> file.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>rw,relatime,data=ordered,discard
</code></pre>
</div>

<h3 id="enable-fan-and-temp-sensor-kernel-modules">Enable fan and temp sensor kernel modules</h3>

<p>Apparently the fan and temperature sensor kernel modules aren’t enabled by default.</p>

<p>Easily fixed by adding <code class="highlighter-rouge">coretemp</code> and <code class="highlighter-rouge">applesmc</code> to <code class="highlighter-rouge">/etc/modules</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code>nano /etc/modules
</code></pre>
</div>

<h3 id="create-a-hostname-for-your-computer">Create a hostname for your computer</h3>

<p>The hostname is what your computer will be referred to as. If you’ve seen <code class="highlighter-rouge">username@computername</code> in terminals before, the computername section is what this hostname will be.</p>

<p>All you need to do is edit it and add your desired hostname. Just the name and nothing else.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>nano /etc/hostname`
</code></pre>
</div>

<p>You’ll also want to add the <code class="highlighter-rouge">hostname</code> after both <code class="highlighter-rouge">localhost</code> instances in your hosts file</p>

<div class="highlighter-rouge"><pre class="highlight"><code>nano /etc/hosts
</code></pre>
</div>

<h3 id="make-initial-kernel--environment-to-open-partitions">Make initial kernel / environment to open partitions</h3>

<p>Admittedly, this is where I get a bit lost but I believe we’re generating the Linux kernel for our OS? I don’t even know what I’m talking about but it’s the next step</p>

<div class="highlighter-rouge"><pre class="highlight"><code>mkinitcpio -p linux
</code></pre>
</div>

<h3 id="set-root-password">Set root password</h3>

<p>Well, simply put, it’s the password used for the root account. You know, for using with <code class="highlighter-rouge">sudo</code> and what not.</p>

<p>It’s as simple as running one command and entering in the password you’d like</p>

<div class="highlighter-rouge"><pre class="highlight"><code>passwd
</code></pre>
</div>

<h3 id="preserve-lan-support-for-later">Preserve LAN support for later</h3>

<p>I don’t recall the exact reason for this but I suppose it’s assumed after the upcoming restart that LAN support will be lost. I never had this issue but there’s no hard in it anyway.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>pacman -S dhcpcd
systemctl enable dhcpcd
</code></pre>
</div>

<h3 id="install-bootloader-for-macbook-pro">Install bootloader for Macbook Pro</h3>

<p>Here is where things went sideways for me. As far as I’m aware, these are the correct commands for installing the UEFI bootloader (I never tried using grub2 which may fix this issue)</p>

<div class="highlighter-rouge"><pre class="highlight"><code>pacman -S dosfstools
bootctl --path=/boot install
</code></pre>
</div>

<h3 id="create-a-boot-entry">Create a boot entry</h3>

<p>We need to make a new entry in the boot segment</p>

<div class="highlighter-rouge"><pre class="highlight"><code>nano /boot/loader/entries/arch.conf
</code></pre>
</div>

<p>and then configure it by entering the following</p>

<div class="language-sh highlighter-rouge"><pre class="highlight"><code>title Arch Linux
linux /vmlinuz-linux
initrd /initramfs-linux.img
options <span class="nv">root</span><span class="o">=</span>/dev/sdb2 rw <span class="nv">elevator</span><span class="o">=</span>deadline quiet splash <span class="nv">resume</span><span class="o">=</span>/dev/sdb3 <span class="nv">nmi_watchdog</span><span class="o">=</span>0
</code></pre>
</div>

<p>Once that’s all done, we then set Arch Linux as our default OS for loading like so</p>

<div class="highlighter-rouge"><pre class="highlight"><code>echo "default arch" &gt; /boot/loader/loader.conf
</code></pre>
</div>

<p>and reboot in order to carry on with the rest of the setup (Desktop environment and what not)</p>

<div class="highlighter-rouge"><pre class="highlight"><code>exit
reboot
</code></pre>
</div>

<p>As I mentioned earlier though, I never got that far since my Macbook never played nice.</p>

<p>This may be of use to someone which is why it’s up there but against, <strong>I couldn’t guarantee this will work on your system even if I wanted to</strong> so keep some extra alternative distros handy just in case you give up.</p>

<p>The <a href="https://help.ubuntu.com/community/MacBookPro">Ubuntu</a> and <a href="https://wiki.archlinux.org/index.php/MacBook">Arch</a> wikis are good resources on where to go next as well as Google of course.</p>

  </article>
</section>

  </div>

  <footer>
  <p>
    <a href="mailto:marcus@thingsima.de">
      <i class="fa fa-envelope"></i>
    </a>
    <a href="https://github.com/marcus-crane">
      <i class="fa fa-github"></i>
    </a>
    <a href="https://linkedin.com/in/placeholderurl">
      <i class="fa fa-linkedin"></i>
    </a>
    <a href="https://steamcommunity.com/id/sandtree">
      <i class="fa fa-steam"></i>
    </a>
    <a href="https://twitter.com/ethernetsalad">
      <i class="fa fa-twitter"></i>
    </a>
  </p>
</footer>

  <script type="text/javascript">
  var _gauges = _gauges || [];
  (function() {
    var t   = document.createElement('script');
    t.type  = 'text/javascript';
    t.async = true;
    t.id    = 'gauges-tracker';
    t.setAttribute('data-site-id', '5846bc99c88d9013c500bbf3');
    t.setAttribute('data-track-path', 'https://track.gaug.es/track.gif');
    t.src = 'https://d36ee2fcip1434.cloudfront.net/track.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(t, s);
  })();
</script>
</body>
</html>
