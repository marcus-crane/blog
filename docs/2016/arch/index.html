<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title> Installing Arch Linux on a Macbook Pro | UTF-9000 </title> <meta name="description" content=" Sometimes I get lost in cyberspace so it&#39;s about time I share my findings! "> <meta name="keywords" content="utf-9000, junior developer, cyberspace"> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <!-- Social: Facebook / Open Graph --> <meta property="og:type" content="article"> <meta property="article:author" content="Marcus Crane"> <meta property="article:section" content="linux,, experiments"> <meta property="article:tag" content=""> <meta property="article:published_time" content="2016-12-19 00:00:00 +1300"> <meta property="og:url" content="http://localhost:4000/2016/arch/"> <meta property="og:title" content=" Installing Arch Linux on a Macbook Pro | UTF-9000 "> <meta property="og:image" content="http://localhost:4000"> <meta property="og:description" content=" Sometimes I get lost in cyberspace so it&#39;s about time I share my findings! "> <meta property="og:site_name" content="Marcus Crane"> <meta property="og:locale" content="en_NZ"> <!-- Social: Twitter --> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:site" content="@ethernetsalad"> <meta name="twitter:title" content=" Installing Arch Linux on a Macbook Pro | UTF-9000 "> <meta name="twitter:description" content=" Sometimes I get lost in cyberspace so it&#39;s about time I share my findings! "> <meta name="twitter:image:src" content="http://localhost:4000"> <!-- Social: Google+ / Schema.org --> <meta itemprop="name" content=" Installing Arch Linux on a Macbook Pro | UTF-9000 "> <meta itemprop="description" content=" Sometimes I get lost in cyberspace so it&#39;s about time I share my findings! "> <meta itemprop="image" content="http://localhost:4000"> <!-- rel prev and next --> <link rel="stylesheet" href="/assets/css/main.css"> <!-- Canonical link tag --> <link rel="canonical" href="http://localhost:4000/2016/arch/"> <link rel="alternate" type="application/rss+xml" title="UTF-9000" href="http://localhost:4000/feed.xml"> <script type="text/javascript"> var disqus_shortname = ''; var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-52446115-1']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script> </head> <body> <main class="wrapper"> <header class="site-header"> <nav class="nav"> <div class="container"> <h1 class="logo"><span><a href="/">UTF-9000</span></a></h1> <ul class="navbar"> <!--<li><a href="/about">about</a></li>--> <li><a href="/feed.xml" target="_blank">feed</a></li> </ul> </div> </nav> </header> <article class="post container" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"> <h1 class="post-title" itemprop="name headline">Installing Arch Linux on a Macbook Pro</h1> <p class="post-meta"><time datetime="2016-12-19T00:00:00+13:00" itemprop="datePublished">Dec 19, 2016</time></p> </header> <div class="post-content" itemprop="articleBody"> <h2 id="the-basic-steps-towards-installing-arch-linux-on-a-macbook-pro">The basic steps towards installing Arch Linux on a Macbook Pro</h2> <p>As a bit of fun, I attempted to try installing Arch Linux on my Macbook Pro.</p> <p>Originally, this didn’t work but I’ve since figured out what I was missing (and I’ve noted it below)</p> <p>This will only be enough for the base install though. You can follow the Arch wiki if you want to go through with installing Gnome but I haven’t decided on a desktop environment I like yet.</p> <p>When I do, I’ll probably do a longer post explaining the steps.</p> <p>The disk partitioning likely isn’t the most efficient use of space so be sure to look up some other guides too.</p> <h4 id="keyboard">Keyboard</h4> <p>First things first:</p> <p>By default, your <code>~</code> key will spit out a <code>&lt;</code> so we need to fix that</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span>touch /etc/rc.local
<span class="nb">echo</span> <span class="s2">&quot;echo 0 &gt; /sys/module/hid_apple/parameters/iso_layout&quot;</span> &gt; /etc/rc.local
<span class="nb">source</span> /etc/rc.local</code></pre></figure> <p>This part pretty much goes for any Linux OS on a Macbook.</p> <h3 id="connect-to-wifi">Connect to WiFi</h3> <p>Next up, we need to connect to WiFi. You can manually use things like the <code>wpa_supplicant.conf</code> file but the built in <code>wifi-menu</code> command is way easier.</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span>wifi-menu</code></pre></figure> <p>Once you’ve set up a profile and connected, you can check that you have an IP address assigned with <code>ip addr</code> and then ping google to check that you’re receiving data with <code>ping google.com -c 3</code></p> <h3 id="partitions">Partitions</h3> <p>This part was a huge pain in the butt for me</p> <p>First we need to get the location of your primary hard drive. You can run <code>fdisk -l</code> to list all of your hard drives. For me, my primary drive is <code>/dev/sdb</code> which may differ for you.</p> <p><strong>Note</strong>: <em>_Going forward, I’ll be using <code>/dev/sdb</code> but if it’s different for you, replace it with your own drive location_</em></p> <p>For myself, I have a 250GB SSD but you’ll have to decide what you’re after yourself.</p> <p>The setup I decided on was a 500MB EFI boot partition, 20GB root partition, 7.5GB swap partition and the remainder assigned to <code>/home</code></p> <p>First step is to run <code>parted /dev/sdb</code> so we can specify how we want to set up our partition</p> <p>EDIT: <strong>NOTE: File locations like [/boot] are just for reference! They are not part of the commands</strong></p> <p>Funnily enough, I was using my own guide to install Arch on an Intel NUC and fell into that trap. I’ve also changed <code>mklabel msdos</code> to <code>mklabel gpt</code> because I forgot to alter my notes.</p> <p>As far as the different between UEFI and BIOS requirements, I’m still learning but you’d use GPT with UEFI in order to be able to make an EFI partition?</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span>mklabel gpt
mkpart ESP fat32 1MiB 500MiB <span class="o">[</span>/boot<span class="o">]</span>
<span class="nb">set</span> <span class="m">1</span> boot on
mkpart primary ext4 500MiB <span class="m">20</span>.5GiB <span class="o">[</span>/<span class="o">]</span>
mkpart primary linux-swap <span class="m">20</span>.5GiB 28GiB <span class="o">[</span>swap<span class="o">]</span>
mkpart primary ext4 28GiB <span class="m">100</span>% <span class="o">[</span>/home<span class="o">]</span>
Ctrl + C</code></pre></figure> <p>Once that’s done, checking <code>fdisk -l</code> again should show the partition setup like so:</p> <table> <thead> <tr> <th>Device</th> <th>Size</th> <th>Type</th> </tr> </thead> <tbody> <tr> <td>/dev/sdb1</td> <td>499M</td> <td>EFI</td> </tr> <tr> <td>/dev/sdb2</td> <td>20G</td> <td>Linux</td> </tr> <tr> <td>/dev/sdb3</td> <td>7.5G</td> <td>Linux swap / Solaris</td> </tr> <tr> <td>/dev/sdb4</td> <td>205.8G</td> <td>Linux</td> </tr> </tbody> </table> <p>Now that we’ve specificied the partitions, we actually need to make some file systems for them and activate the swap partition:</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span>mkfs.vfat -F32 /dev/sdb1 <span class="o">[</span>/boot<span class="o">]</span>
mkfs.ext4 /dev/sdb2 <span class="o">[</span>/<span class="o">]</span>
mkswap /dev/sdb3 <span class="o">[</span>swap<span class="o">]</span>
swapon /dev/sdb3
mkfs.ext4 /dev/sdb4 <span class="o">[</span>/home<span class="o">]</span></code></pre></figure> <h3 id="mounting-the-filesystems">Mounting the filesystems</h3> <p>With our filesystems created and swap partition activated, we can mount the filesystems in order to start installing our operating system</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span>mount /dev/sdb2 /mnt
mkdir -p /mnt/boot
mount /dev/sdb1 /mnt/boot
mkdir -p /mnt/home
mount /dev/sdb4 /mnt/home</code></pre></figure> <p>For anyone wondering why they’ve never seen <code>/mnt</code> before, it doesn’t actually exist. In the end, it just resolves to <code>/</code>. For example, <code>/mnt/home</code> just becomes <code>/home</code> and so on.</p> <h3 id="installing-base-packages">Installing base packages</h3> <p>With the filesystems mounted, it’s time to install the base Arch packages</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span>pacstrap /mnt base base-devel</code></pre></figure> <h3 id="fiddly-setup-bits-and-pieces">Fiddly setup bits and pieces</h3> <p>This is the last little step before we can get a <code>bash</code> sh running which should make terminal fans feel more comfortable.</p> <p>We’ll want to generate an fstab template to <code>/etc/fstab</code> for later so we can name our filesystems and then use <code>arch-chroot</code> to get bash working</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span>genfstab -U /mnt &gt;&gt; /mnt/etc/fstab
arch-chroot /mnt /bin/bash</code></pre></figure> <p>Next we’ll generate our locale. When you edit <code>/etc/locale.gen</code>, you’ll see every available locale and you just need to uncomment your respective one. For me, it’s <code>en_NZ.UTF-8</code>.</p> <p>For you, it’ll just be whichever matches your respective language and country code. You’ll likely want to choose the <code>UTF-8</code> option if there are multiple choices.</p> <p>Generate locale</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span>nano /etc/locale.gen
locale-gen
<span class="nb">echo</span> <span class="nv">LANG</span><span class="o">={</span>locale<span class="o">}</span> &gt; /etc/locale.conf</code></pre></figure> <p>I hope it goes without saying that <strong>{locale} is a placeholder. Swap it with your own locale eg: <code>LANG=en_NZ.UTF-8</code></strong></p> <p>Next, we’ll be setting our timezones. Again, just swap NZ for your country code.</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span>ln -sf /usr/share/zoneinfo/NZ /etc/localtime
hwclock --systohc</code></pre></figure> <h3 id="fix-boot-order-and-optimise-ssd">Fix boot order and optimise SSD</h3> <p>This part can be a bit confusing. By default, in your <code>fstab</code> file, the boot order of your partitions may possibly be the wrong way around.</p> <p>For me, <code>/dev/sdb1</code> should be set to <code>01</code> and <code>/dev/sdb2</code> should be set to <code>02</code> but they were the wrong way around.</p> <p>You’ll want to edit fstab and make sure they’re set correctly.</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span>nano /etc/fstab</code></pre></figure> <p>For some optional optimisation (no idea what, I just saw this somewhere along the way), you can add <code>discard</code> to the line <code>rw,relatime,data=ordered</code> on the <code>/home</code> partition in your <code>fstab</code> file.</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span>rw,relatime,data<span class="o">=</span>ordered,discard</code></pre></figure> <h3 id="enable-fan-and-temp-sensor-kernel-modules">Enable fan and temp sensor kernel modules</h3> <p>Apparently the fan and temperature sensor kernel modules aren’t enabled by default.</p> <p>Easily fixed by adding <code>coretemp</code> and <code>applesmc</code> to <code>/etc/modules</code></p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span>nano /etc/modules</code></pre></figure> <h3 id="create-a-hostname-for-your-computer">Create a hostname for your computer</h3> <p>The hostname is what your computer will be referred to as. If you’ve seen <code>username@computername</code> in terminals before, the computername section is what this hostname will be.</p> <p>All you need to do is edit it and add your desired hostname. Just the name and nothing else.</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span>nano /etc/hostname</code></pre></figure> <p>You’ll also want to add the <code>hostname</code> after both <code>localhost</code> instances in your hosts file</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span>nano /etc/hosts</code></pre></figure> <h3 id="make-initial-kernel--environment-to-open-partitions">Make initial kernel / environment to open partitions</h3> <p>Admittedly, this is where I get a bit lost but I believe we’re generating the Linux kernel for our OS? I don’t even know what I’m talking about but it’s the next step</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span>mkinitcpio -p linux</code></pre></figure> <h3 id="set-root-password">Set root password</h3> <p>Well, simply put, it’s the password used for the root account. You know, for using with <code>sudo</code> and what not.</p> <p>It’s as simple as running one command and entering in the password you’d like</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span>passwd</code></pre></figure> <h3 id="preserve-lan-support-for-later">Preserve LAN support for later</h3> <p>I don’t recall the exact reason for this but I suppose it’s assumed after the upcoming restart that LAN support will be lost. I never had this issue but there’s no hard in it anyway.</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span>pacman -S dhcpcd
systemctl <span class="nb">enable</span> dhcpcd</code></pre></figure> <h3 id="install-bootloader-for-macbook-pro">Install bootloader for Macbook Pro</h3> <p>Here is where things went sideways for me. As far as I’m aware, these are the correct commands for installing the UEFI bootloader (I never tried using grub2 which may fix this issue)</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span>pacman -S dosfstools
bootctl --path<span class="o">=</span>/boot install</code></pre></figure> <h3 id="create-a-boot-entry">Create a boot entry</h3> <p>We need to make a new entry in the boot segment</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span>nano /boot/loader/entries/arch.conf</code></pre></figure> <p>and then configure it by entering the following</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span>title Arch Linux
linux /vmlinuz-linux
initrd /initramfs-linux.img
options <span class="nv">root</span><span class="o">=</span>/dev/sda2 rw <span class="nv">elevator</span><span class="o">=</span>deadline quiet splash <span class="nv">resume</span><span class="o">=</span>/dev/sda3 <span class="nv">nmi_watchdog</span><span class="o">=</span><span class="m">0</span></code></pre></figure> <p><strong>NOTE</strong>: Yes, I reference <code>sda</code> and not <code>sdb</code> here. For whatever reason, the drive swaps to being <code>/dev/sda</code> once the install is completed and you reboot. This is what originally gave me trouble. I was referencing <code>/dev/sdb</code> which didn’t exist anymore.</p> <p>Once that’s all done, we then set Arch Linux as our default OS for loading like so</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span><span class="nb">echo</span> <span class="s2">&quot;default arch&quot;</span> &gt; /boot/loader/loader.conf</code></pre></figure> <p>and reboot in order to carry on with the rest of the setup (Desktop environment and what not)</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span></span><span class="nb">exit</span>
reboot</code></pre></figure> <p>At this point, rebooting should give you the basics of an operating system but it won’t be enough to use on a daily basis.</p> <p>The <a href="https://help.ubuntu.com/community/MacBookPro">Ubuntu</a> and <a href="https://wiki.archlinux.org/index.php/MacBook">Arch</a> wikis are good resources on where to go next as well as Google of course.</p> <aside class="share"> <h5>You can share this on <a href="http://twitter.com/share?text=I liked this post called Installing Arch Linux on a Macbook Pro from" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">Twitter</a> or <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/2016/arch/" onclick="window.open(this.href, 'facebook-share', 'width=550,height=235');return false;">Facebook</a> </h5> </aside> </div> </article> <footer class="site-footer"> <div class="container"> <small class="pull-left">&copy;2017 All rights reserved. Made with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a>, <a href="https://github.com/nandomoreirame/simplest" target="_blank">Simplest</a> and ♥</small> <small class="pull-right"></small> </div> </footer> </main> </body> </html>
